<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 3 章 数据预处理 | 基于 R 的数据处理流程指南</title>
  <meta name="description" content="R快速查询工具指南" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="第 3 章 数据预处理 | 基于 R 的数据处理流程指南" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="R快速查询工具指南" />
  <meta name="github-repo" content="nicheerfeng/git_book_ftidy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 3 章 数据预处理 | 基于 R 的数据处理流程指南" />
  
  <meta name="twitter:description" content="R快速查询工具指南" />
  

<meta name="author" content="Teague Tian" />


<meta name="date" content="2022-09-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="image/favicon.ico" type="image/x-icon" />
<link rel="prev" href="Data-extraction.html"/>
<link rel="next" href="Model-building.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Data Workflow</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a>
<ul>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#学业及工作经历"><i class="fa fa-check"></i>学业及工作经历：</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#研究兴趣"><i class="fa fa-check"></i>研究兴趣：</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#已完成和正在研究的项目"><i class="fa fa-check"></i>已完成和正在研究的项目</a>
<ul>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#医学领域"><i class="fa fa-check"></i>医学领域：</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#生态学领域"><i class="fa fa-check"></i>生态学领域：</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#r工具开发"><i class="fa fa-check"></i>R工具开发：</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="Establish-analysis-objectives.html"><a href="Establish-analysis-objectives.html"><i class="fa fa-check"></i><b>1</b> 确立分析目标</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Establish-analysis-objectives.html"><a href="Establish-analysis-objectives.html#基本逻辑"><i class="fa fa-check"></i><b>1.1</b> 基本逻辑</a></li>
<li class="chapter" data-level="1.2" data-path="Establish-analysis-objectives.html"><a href="Establish-analysis-objectives.html#数据分析的基本流程"><i class="fa fa-check"></i><b>1.2</b> 数据分析的基本流程</a></li>
<li class="chapter" data-level="1.3" data-path="Establish-analysis-objectives.html"><a href="Establish-analysis-objectives.html#工作处理经验"><i class="fa fa-check"></i><b>1.3</b> 工作处理经验</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="Establish-analysis-objectives.html"><a href="Establish-analysis-objectives.html#ppt汇报经验"><i class="fa fa-check"></i><b>1.3.1</b> PPT汇报经验：</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>数据准备</b></span></li>
<li class="chapter" data-level="2" data-path="Data-extraction.html"><a href="Data-extraction.html"><i class="fa fa-check"></i><b>2</b> 数据提取</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Data-extraction.html"><a href="Data-extraction.html#数据提取的基本范式"><i class="fa fa-check"></i><b>2.1</b> 数据提取的基本范式</a></li>
<li class="chapter" data-level="2.2" data-path="Data-extraction.html"><a href="Data-extraction.html#数据导入与导出"><i class="fa fa-check"></i><b>2.2</b> 数据导入与导出</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="Data-extraction.html"><a href="Data-extraction.html#剪切板中处理数据"><i class="fa fa-check"></i><b>2.2.1</b> 剪切板中处理数据</a></li>
<li class="chapter" data-level="2.2.2" data-path="Data-extraction.html"><a href="Data-extraction.html#读取excle文件"><i class="fa fa-check"></i><b>2.2.2</b> 读取excle文件</a></li>
<li class="chapter" data-level="2.2.3" data-path="Data-extraction.html"><a href="Data-extraction.html#加速读取及导出常用数据"><i class="fa fa-check"></i><b>2.2.3</b> 加速读取及导出常用数据</a></li>
<li class="chapter" data-level="2.2.4" data-path="Data-extraction.html"><a href="Data-extraction.html#office格式及图片导出"><i class="fa fa-check"></i><b>2.2.4</b> OFFICE格式及图片导出</a></li>
<li class="chapter" data-level="2.2.5" data-path="Data-extraction.html"><a href="Data-extraction.html#在r中使用sql"><i class="fa fa-check"></i><b>2.2.5</b> 在R中使用sql</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html"><i class="fa fa-check"></i><b>3</b> 数据预处理</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据抽取"><i class="fa fa-check"></i><b>3.1</b> 数据抽取</a></li>
<li class="chapter" data-level="3.2" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据清洗"><i class="fa fa-check"></i><b>3.2</b> 数据清洗</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#选择数据子集"><i class="fa fa-check"></i><b>3.2.1</b> 选择数据子集</a></li>
<li class="chapter" data-level="3.2.2" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据去重"><i class="fa fa-check"></i><b>3.2.2</b> 数据去重</a></li>
<li class="chapter" data-level="3.2.3" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#缺失值处理"><i class="fa fa-check"></i><b>3.2.3</b> 缺失值处理</a></li>
<li class="chapter" data-level="3.2.4" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#一致化处理-1"><i class="fa fa-check"></i><b>3.2.4</b> 一致化处理</a></li>
<li class="chapter" data-level="3.2.5" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#异常值处理-1"><i class="fa fa-check"></i><b>3.2.5</b> 异常值处理</a></li>
<li class="chapter" data-level="3.2.6" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#插值填补"><i class="fa fa-check"></i><b>3.2.6</b> 插值填补</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据重组与转换"><i class="fa fa-check"></i><b>3.3</b> 数据重组与转换</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据修改-数据增加与删除"><i class="fa fa-check"></i><b>3.3.1</b> 数据修改-数据增加与删除</a></li>
<li class="chapter" data-level="3.3.2" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据值重编码非列名"><i class="fa fa-check"></i><b>3.3.2</b> 数据值重编码（非列名）</a></li>
<li class="chapter" data-level="3.3.3" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据塑形"><i class="fa fa-check"></i><b>3.3.3</b> 数据塑形</a></li>
<li class="chapter" data-level="3.3.4" data-path="Data-preprocessing.html"><a href="Data-preprocessing.html#数据提取"><i class="fa fa-check"></i><b>3.3.4</b> 数据提取</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>模型拟合</b></span></li>
<li class="chapter" data-level="4" data-path="Model-building.html"><a href="Model-building.html"><i class="fa fa-check"></i><b>4</b> 构建模型</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Model-building.html"><a href="Model-building.html#描述统计模型"><i class="fa fa-check"></i><b>4.1</b> 描述统计模型</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="Model-building.html"><a href="Model-building.html#快速构建描述性统计"><i class="fa fa-check"></i><b>4.1.1</b> 快速构建描述性统计</a></li>
<li class="chapter" data-level="4.1.2" data-path="Model-building.html"><a href="Model-building.html#高级分组统计"><i class="fa fa-check"></i><b>4.1.2</b> 高级分组统计</a></li>
<li class="chapter" data-level="4.1.3" data-path="Model-building.html"><a href="Model-building.html#常用统计函数"><i class="fa fa-check"></i><b>4.1.3</b> 常用统计函数</a></li>
<li class="chapter" data-level="4.1.4" data-path="Model-building.html"><a href="Model-building.html#批处理函数"><i class="fa fa-check"></i><b>4.1.4</b> 批处理函数</a></li>
<li class="chapter" data-level="4.1.5" data-path="Model-building.html"><a href="Model-building.html#broom优雅输出"><i class="fa fa-check"></i><b>4.1.5</b> BROOM优雅输出</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="Model-building.html"><a href="Model-building.html#复杂统计模型"><i class="fa fa-check"></i><b>4.2</b> 复杂统计模型</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Model-building.html"><a href="Model-building.html#变量筛选"><i class="fa fa-check"></i><b>4.2.1</b> 变量筛选</a></li>
<li class="chapter" data-level="4.2.2" data-path="Model-building.html"><a href="Model-building.html#线性统计回归"><i class="fa fa-check"></i><b>4.2.2</b> 线性统计回归</a></li>
<li class="chapter" data-level="4.2.3" data-path="Model-building.html"><a href="Model-building.html#方差检验"><i class="fa fa-check"></i><b>4.2.3</b> 方差检验</a></li>
<li class="chapter" data-level="4.2.4" data-path="Model-building.html"><a href="Model-building.html#相关统计r包资源"><i class="fa fa-check"></i><b>4.2.4</b> 相关统计R包资源：</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Model-building.html"><a href="Model-building.html#临床统计模型"><i class="fa fa-check"></i><b>4.3</b> 临床统计模型</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="Model-building.html"><a href="Model-building.html#平衡匹配"><i class="fa fa-check"></i><b>4.3.1</b> 平衡匹配</a></li>
<li class="chapter" data-level="4.3.2" data-path="Model-building.html"><a href="Model-building.html#生存分析"><i class="fa fa-check"></i><b>4.3.2</b> 生存分析</a></li>
<li class="chapter" data-level="4.3.3" data-path="Model-building.html"><a href="Model-building.html#补充r包"><i class="fa fa-check"></i><b>4.3.3</b> 补充R包</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="Model-building.html"><a href="Model-building.html#构造模型的辅助函数或参数"><i class="fa fa-check"></i><b>4.4</b> 构造模型的辅助函数或参数</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="Model-building.html"><a href="Model-building.html#常用参数"><i class="fa fa-check"></i><b>4.4.1</b> 常用参数</a></li>
<li class="chapter" data-level="4.4.2" data-path="Model-building.html"><a href="Model-building.html#查询线性模型结果"><i class="fa fa-check"></i><b>4.4.2</b> 查询线性模型结果</a></li>
<li class="chapter" data-level="4.4.3" data-path="Model-building.html"><a href="Model-building.html#r语言笔记.formula"><i class="fa fa-check"></i><b>4.4.3</b> R语言笔记.formula</a></li>
<li class="chapter" data-level="4.4.4" data-path="Model-building.html"><a href="Model-building.html#特征工程"><i class="fa fa-check"></i><b>4.4.4</b> 特征工程</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="Model-building.html"><a href="Model-building.html#深度学习"><i class="fa fa-check"></i><b>4.5</b> 深度学习</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="Model-building.html"><a href="Model-building.html#r-中执行keras"><i class="fa fa-check"></i><b>4.5.1</b> R 中执行keras</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="Model-building.html"><a href="Model-building.html#机器学习"><i class="fa fa-check"></i><b>4.6</b> 机器学习</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="Model-building.html"><a href="Model-building.html#机器学习--mlr3包"><i class="fa fa-check"></i><b>4.6.1</b> 机器学习 -mlr3包</a></li>
<li class="chapter" data-level="4.6.2" data-path="Model-building.html"><a href="Model-building.html#常规机器学习"><i class="fa fa-check"></i><b>4.6.2</b> 常规机器学习</a></li>
<li class="chapter" data-level="4.6.3" data-path="Model-building.html"><a href="Model-building.html#朴素贝叶斯"><i class="fa fa-check"></i><b>4.6.3</b> 朴素贝叶斯</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Model-performance.html"><a href="Model-performance.html"><i class="fa fa-check"></i><b>5</b> 模型评估</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Model-performance.html"><a href="Model-performance.html#模型评估辅助"><i class="fa fa-check"></i><b>5.1</b> 模型评估辅助：</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="Model-performance.html"><a href="Model-performance.html#purrr包的pluck函数字符提取"><i class="fa fa-check"></i><b>5.1.1</b> purrr包的pluck()函数字符提取</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="Model-performance.html"><a href="Model-performance.html#常用模型辅助评估r包"><i class="fa fa-check"></i><b>5.2</b> 常用模型辅助评估R包：</a></li>
</ul></li>
<li class="part"><span><b>模型展示</b></span></li>
<li class="chapter" data-level="6" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html"><i class="fa fa-check"></i><b>6</b> 模型发布与应用</a>
<ul>
<li class="chapter" data-level="6.1" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#flexboard"><i class="fa fa-check"></i><b>6.1</b> flexboard</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#安装工作环境"><i class="fa fa-check"></i><b>6.1.1</b> 安装工作环境</a></li>
<li class="chapter" data-level="6.1.2" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#多级导航模块"><i class="fa fa-check"></i><b>6.1.2</b> 多级导航模块</a></li>
<li class="chapter" data-level="6.1.3" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#超级链接表"><i class="fa fa-check"></i><b>6.1.3</b> 超级链接表</a></li>
<li class="chapter" data-level="6.1.4" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#给导航栏添加social-links"><i class="fa fa-check"></i><b>6.1.4</b> 给导航栏添加Social Links</a></li>
<li class="chapter" data-level="6.1.5" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#给导航栏添加source-code"><i class="fa fa-check"></i><b>6.1.5</b> 给导航栏添加Source Code</a></li>
<li class="chapter" data-level="6.1.6" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#给导航栏添加一个about"><i class="fa fa-check"></i><b>6.1.6</b> 给导航栏添加一个<code>about</code></a></li>
<li class="chapter" data-level="6.1.7" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#布局参数"><i class="fa fa-check"></i><b>6.1.7</b> 布局参数</a></li>
<li class="chapter" data-level="6.1.8" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#功能块参数"><i class="fa fa-check"></i><b>6.1.8</b> 功能块参数</a></li>
<li class="chapter" data-level="6.1.9" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#故事版"><i class="fa fa-check"></i><b>6.1.9</b> 故事版</a></li>
<li class="chapter" data-level="6.1.10" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#辅助dashboard展示参数"><i class="fa fa-check"></i><b>6.1.10</b> 辅助dashboard展示参数</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#shinydashboard"><i class="fa fa-check"></i><b>6.2</b> shinydashboard</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#基本框架和流程"><i class="fa fa-check"></i><b>6.2.1</b> 基本框架和流程</a></li>
<li class="chapter" data-level="6.2.2" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#仪表板的结构"><i class="fa fa-check"></i><b>6.2.2</b> 仪表板的结构</a></li>
<li class="chapter" data-level="6.2.3" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#布局参数-1"><i class="fa fa-check"></i><b>6.2.3</b> 布局参数</a></li>
<li class="chapter" data-level="6.2.4" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#在dashboard中使用css技巧"><i class="fa fa-check"></i><b>6.2.4</b> 在dashboard中使用css技巧</a></li>
<li class="chapter" data-level="6.2.5" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#适配于shiny的特殊函数"><i class="fa fa-check"></i><b>6.2.5</b> 适配于shiny的特殊函数</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#rmarkdown使用进阶"><i class="fa fa-check"></i><b>6.3</b> Rmarkdown使用进阶</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#参考书目"><i class="fa fa-check"></i><b>6.3.1</b> 参考书目</a></li>
<li class="chapter" data-level="6.3.2" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#title和autherymal"><i class="fa fa-check"></i><b>6.3.2</b> title和auther/YMAL</a></li>
<li class="chapter" data-level="6.3.3" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#字体与格式"><i class="fa fa-check"></i><b>6.3.3</b> 字体与格式</a></li>
<li class="chapter" data-level="6.3.4" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#辅助标记"><i class="fa fa-check"></i><b>6.3.4</b> 辅助标记</a></li>
<li class="chapter" data-level="6.3.5" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#常用代码标签"><i class="fa fa-check"></i><b>6.3.5</b> 常用代码标签</a></li>
<li class="chapter" data-level="6.3.6" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#非常用代码标签"><i class="fa fa-check"></i><b>6.3.6</b> 非常用代码标签</a></li>
<li class="chapter" data-level="6.3.7" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#快捷键"><i class="fa fa-check"></i><b>6.3.7</b> 快捷键</a></li>
<li class="chapter" data-level="6.3.8" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#标题修改"><i class="fa fa-check"></i><b>6.3.8</b> 标题修改</a></li>
<li class="chapter" data-level="6.3.9" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#图片处理"><i class="fa fa-check"></i><b>6.3.9</b> 图片处理</a></li>
<li class="chapter" data-level="6.3.10" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#表格输出"><i class="fa fa-check"></i><b>6.3.10</b> 表格输出</a></li>
<li class="chapter" data-level="6.3.11" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#结果输出"><i class="fa fa-check"></i><b>6.3.11</b> 结果输出</a></li>
<li class="chapter" data-level="6.3.12" data-path="id_06-Model-release-and-application.html"><a href="id_06-Model-release-and-application.html#补充知识点"><i class="fa fa-check"></i><b>6.3.12</b> 补充知识点</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html"><i class="fa fa-check"></i><b>7</b> 可视化（表与图）</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#表格可视化"><i class="fa fa-check"></i><b>7.1</b> 表格可视化</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#快速图表可视化"><i class="fa fa-check"></i><b>7.1.1</b> 快速图表可视化</a></li>
<li class="chapter" data-level="7.1.2" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#编辑表"><i class="fa fa-check"></i><b>7.1.2</b> 编辑表</a></li>
<li class="chapter" data-level="7.1.3" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#静态表格优化展示"><i class="fa fa-check"></i><b>7.1.3</b> 静态表格优化展示</a></li>
<li class="chapter" data-level="7.1.4" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#动态表格优化展示"><i class="fa fa-check"></i><b>7.1.4</b> 动态表格优化展示</a></li>
<li class="chapter" data-level="7.1.5" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#描述性统计表格分析"><i class="fa fa-check"></i><b>7.1.5</b> 描述性统计表格分析</a></li>
<li class="chapter" data-level="7.1.6" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#统计结果表格可视化"><i class="fa fa-check"></i><b>7.1.6</b> 统计结果表格可视化</a></li>
<li class="chapter" data-level="7.1.7" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#补充表格包"><i class="fa fa-check"></i><b>7.1.7</b> 补充表格包</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#图形可视化"><i class="fa fa-check"></i><b>7.2</b> 图形可视化</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#画图参考网站"><i class="fa fa-check"></i><b>7.2.1</b> 画图参考网站</a></li>
<li class="chapter" data-level="7.2.2" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#免代码绘制"><i class="fa fa-check"></i><b>7.2.2</b> 免代码绘制</a></li>
<li class="chapter" data-level="7.2.3" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#统计辅助绘图"><i class="fa fa-check"></i><b>7.2.3</b> 统计辅助绘图</a></li>
<li class="chapter" data-level="7.2.4" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#base-plotggplot2"><i class="fa fa-check"></i><b>7.2.4</b> base-plot()/ggplot2()</a></li>
<li class="chapter" data-level="7.2.5" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#绘图"><i class="fa fa-check"></i><b>7.2.5</b> 绘图</a></li>
<li class="chapter" data-level="7.2.6" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#统计图形代码"><i class="fa fa-check"></i><b>7.2.6</b> 统计图形代码</a></li>
<li class="chapter" data-level="7.2.7" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#医学分析图"><i class="fa fa-check"></i><b>7.2.7</b> 医学分析图</a></li>
<li class="chapter" data-level="7.2.8" data-path="Visualization-Tables-Figures.html"><a href="Visualization-Tables-Figures.html#补充图形库"><i class="fa fa-check"></i><b>7.2.8</b> 补充图形库</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>工具箱</b></span></li>
<li class="chapter" data-level="8" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html"><i class="fa fa-check"></i><b>8</b> 常用统计R代码</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#r-系统功能"><i class="fa fa-check"></i><b>8.1</b> R-系统功能</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#常用r系统代码"><i class="fa fa-check"></i><b>8.1.1</b> 常用R系统代码</a></li>
<li class="chapter" data-level="8.1.2" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#辅助r包"><i class="fa fa-check"></i><b>8.1.2</b> 辅助R包：</a></li>
<li class="chapter" data-level="8.1.3" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#常用系统脚本"><i class="fa fa-check"></i><b>8.1.3</b> 常用系统脚本</a></li>
<li class="chapter" data-level="8.1.4" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#s3和s4事件"><i class="fa fa-check"></i><b>8.1.4</b> S3和S4事件</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#r报错机制学习"><i class="fa fa-check"></i><b>8.2</b> R报错机制学习</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#常见异常处理函数"><i class="fa fa-check"></i><b>8.2.1</b> 1 常见异常处理函数</a></li>
<li class="chapter" data-level="8.2.2" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#stop"><i class="fa fa-check"></i><b>8.2.2</b> 2 STOP</a></li>
<li class="chapter" data-level="8.2.3" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#warning"><i class="fa fa-check"></i><b>8.2.3</b> 3 WARNING</a></li>
<li class="chapter" data-level="8.2.4" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#捕捉错误"><i class="fa fa-check"></i><b>8.2.4</b> 4 捕捉错误</a></li>
<li class="chapter" data-level="8.2.5" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#代码错误调试"><i class="fa fa-check"></i><b>8.2.5</b> 5 代码错误调试</a></li>
<li class="chapter" data-level="8.2.6" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#代码时间消耗跟踪"><i class="fa fa-check"></i><b>8.2.6</b> 6 代码时间消耗跟踪</a></li>
<li class="chapter" data-level="8.2.7" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#补充案例"><i class="fa fa-check"></i><b>8.2.7</b> 7 补充案例</a></li>
<li class="chapter" data-level="8.2.8" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#相关资料"><i class="fa fa-check"></i><b>8.2.8</b> 8 相关资料</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#常用快捷命令"><i class="fa fa-check"></i><b>8.3</b> 常用快捷命令</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#高效管道符号"><i class="fa fa-check"></i><b>8.3.1</b> 高效管道符号</a></li>
<li class="chapter" data-level="8.3.2" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#常用辅助函数"><i class="fa fa-check"></i><b>8.3.2</b> 常用辅助函数：</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#正则表达式"><i class="fa fa-check"></i><b>8.4</b> 正则表达式</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#常用正则表达式命令-1"><i class="fa fa-check"></i><b>8.4.1</b> 常用正则表达式命令-1</a></li>
<li class="chapter" data-level="8.4.2" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#常用正则表达式命令-2"><i class="fa fa-check"></i><b>8.4.2</b> 常用正则表达式命令-2</a></li>
<li class="chapter" data-level="8.4.3" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#量词"><i class="fa fa-check"></i><b>8.4.3</b> 量词</a></li>
<li class="chapter" data-level="8.4.4" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#捕获分组"><i class="fa fa-check"></i><b>8.4.4</b> 捕获分组</a></li>
<li class="chapter" data-level="8.4.5" data-path="Common-statistical-R-code.html"><a href="Common-statistical-R-code.html#python使用编译"><i class="fa fa-check"></i><b>8.4.5</b> python使用编译</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html"><i class="fa fa-check"></i><b>9</b> 临床医学统计流</a>
<ul>
<li class="chapter" data-level="9.1" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#common.r"><i class="fa fa-check"></i><b>9.1</b> COMMON.R</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#加载r包和配置全局环境"><i class="fa fa-check"></i><b>9.1.1</b> 加载R包和配置全局环境</a></li>
<li class="chapter" data-level="9.1.2" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#使用officer来启动函数参数"><i class="fa fa-check"></i><b>9.1.2</b> 使用officer来启动函数参数：</a></li>
<li class="chapter" data-level="9.1.3" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#table-of-content"><i class="fa fa-check"></i><b>9.1.3</b> Table of content</a></li>
<li class="chapter" data-level="9.1.4" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#cover-template--封面"><i class="fa fa-check"></i><b>9.1.4</b> Cover template -封面</a></li>
<li class="chapter" data-level="9.1.5" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#快捷辅助函数"><i class="fa fa-check"></i><b>9.1.5</b> 快捷辅助函数：</a></li>
<li class="chapter" data-level="9.1.6" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#快捷统计函数"><i class="fa fa-check"></i><b>9.1.6</b> 快捷统计函数：</a></li>
<li class="chapter" data-level="9.1.7" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#描述性分析统计函数"><i class="fa fa-check"></i><b>9.1.7</b> 描述性分析统计函数</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#rawdata-cleaning-pipeline"><i class="fa fa-check"></i><b>9.2</b> Rawdata cleaning pipeline</a></li>
<li class="chapter" data-level="9.3" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#target_groups"><i class="fa fa-check"></i><b>9.3</b> target_groups</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#加载集成数据集"><i class="fa fa-check"></i><b>9.3.1</b> 加载集成数据集</a></li>
<li class="chapter" data-level="9.3.2" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#保存数据集"><i class="fa fa-check"></i><b>9.3.2</b> 保存数据集</a></li>
<li class="chapter" data-level="9.3.3" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#患者平衡匹配前后信息比较"><i class="fa fa-check"></i><b>9.3.3</b> 患者平衡匹配前后信息比较</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#dataset_for_analysis"><i class="fa fa-check"></i><b>9.4</b> dataset_for_analysis</a></li>
<li class="chapter" data-level="9.5" data-path="Statistical-flow-of-clinical-medicine.html"><a href="Statistical-flow-of-clinical-medicine.html#final_analysis"><i class="fa fa-check"></i><b>9.5</b> final_analysis</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Statistical-books.html"><a href="Statistical-books.html"><i class="fa fa-check"></i><b>10</b> 统计书籍</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Statistical-books.html"><a href="Statistical-books.html#r-统计书籍"><i class="fa fa-check"></i><b>10.1</b> R-统计书籍</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Statistical-books.html"><a href="Statistical-books.html#tidyverse相关"><i class="fa fa-check"></i><b>10.1.1</b> tidyverse相关</a></li>
<li class="chapter" data-level="10.1.2" data-path="Statistical-books.html"><a href="Statistical-books.html#ggplo2相关-网站"><i class="fa fa-check"></i><b>10.1.2</b> ggplo2相关-网站</a></li>
<li class="chapter" data-level="10.1.3" data-path="Statistical-books.html"><a href="Statistical-books.html#绘图指南"><i class="fa fa-check"></i><b>10.1.3</b> 绘图指南</a></li>
<li class="chapter" data-level="10.1.4" data-path="Statistical-books.html"><a href="Statistical-books.html#绘图相关的博客"><i class="fa fa-check"></i><b>10.1.4</b> 绘图相关的博客</a></li>
<li class="chapter" data-level="10.1.5" data-path="Statistical-books.html"><a href="Statistical-books.html#医学指南相关"><i class="fa fa-check"></i><b>10.1.5</b> 医学指南相关</a></li>
<li class="chapter" data-level="10.1.6" data-path="Statistical-books.html"><a href="Statistical-books.html#医学统计r包"><i class="fa fa-check"></i><b>10.1.6</b> 医学统计R包</a></li>
<li class="chapter" data-level="10.1.7" data-path="Statistical-books.html"><a href="Statistical-books.html#医学统计相关博客"><i class="fa fa-check"></i><b>10.1.7</b> 医学统计相关博客</a></li>
<li class="chapter" data-level="10.1.8" data-path="Statistical-books.html"><a href="Statistical-books.html#统计指南-r代码实现"><i class="fa fa-check"></i><b>10.1.8</b> 统计指南-R代码实现</a></li>
<li class="chapter" data-level="10.1.9" data-path="Statistical-books.html"><a href="Statistical-books.html#数据建模相关"><i class="fa fa-check"></i><b>10.1.9</b> 数据建模相关</a></li>
<li class="chapter" data-level="10.1.10" data-path="Statistical-books.html"><a href="Statistical-books.html#整合流程"><i class="fa fa-check"></i><b>10.1.10</b> 整合流程</a></li>
<li class="chapter" data-level="10.1.11" data-path="Statistical-books.html"><a href="Statistical-books.html#博客社区"><i class="fa fa-check"></i><b>10.1.11</b> 博客社区</a></li>
<li class="chapter" data-level="10.1.12" data-path="Statistical-books.html"><a href="Statistical-books.html#rmarkdown"><i class="fa fa-check"></i><b>10.1.12</b> Rmarkdown</a></li>
<li class="chapter" data-level="10.1.13" data-path="Statistical-books.html"><a href="Statistical-books.html#r-rstudio"><i class="fa fa-check"></i><b>10.1.13</b> R-Rstudio</a></li>
<li class="chapter" data-level="10.1.14" data-path="Statistical-books.html"><a href="Statistical-books.html#shiny"><i class="fa fa-check"></i><b>10.1.14</b> shiny</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Statistical-books.html"><a href="Statistical-books.html#使用gitbook写书"><i class="fa fa-check"></i><b>10.2</b> 使用gitbook写书</a></li>
<li class="chapter" data-level="10.3" data-path="Statistical-books.html"><a href="Statistical-books.html#使用bookdwon写书"><i class="fa fa-check"></i><b>10.3</b> 使用bookdwon写书</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Statistical-books.html"><a href="Statistical-books.html#常用功能标记"><i class="fa fa-check"></i><b>10.3.1</b> 常用功能标记</a></li>
<li class="chapter" data-level="10.3.2" data-path="Statistical-books.html"><a href="Statistical-books.html#r代码的构建"><i class="fa fa-check"></i><b>10.3.2</b> R代码的构建</a></li>
<li class="chapter" data-level="10.3.3" data-path="Statistical-books.html"><a href="Statistical-books.html#动态r代码"><i class="fa fa-check"></i><b>10.3.3</b> 动态r代码</a></li>
<li class="chapter" data-level="10.3.4" data-path="Statistical-books.html"><a href="Statistical-books.html#引入shiny应用"><i class="fa fa-check"></i><b>10.3.4</b> 引入shiny应用</a></li>
<li class="chapter" data-level="10.3.5" data-path="Statistical-books.html"><a href="Statistical-books.html#指定输出和解析的文件"><i class="fa fa-check"></i><b>10.3.5</b> 指定输出和解析的文件</a></li>
<li class="chapter" data-level="10.3.6" data-path="Statistical-books.html"><a href="Statistical-books.html#文件最后修改时间"><i class="fa fa-check"></i><b>10.3.6</b> 文件最后修改时间</a></li>
<li class="chapter" data-level="10.3.7" data-path="Statistical-books.html"><a href="Statistical-books.html#添加指定序号"><i class="fa fa-check"></i><b>10.3.7</b> 添加指定序号</a></li>
<li class="chapter" data-level="10.3.8" data-path="Statistical-books.html"><a href="Statistical-books.html#辅助知识-"><i class="fa fa-check"></i><b>10.3.8</b> 辅助知识：—-</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html"><i class="fa fa-check"></i><b>11</b> 统计与研究设计</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#常用参数释义"><i class="fa fa-check"></i><b>11.1</b> 常用参数释义</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#因果回归参数"><i class="fa fa-check"></i><b>11.1.1</b> 因果回归参数</a></li>
<li class="chapter" data-level="11.1.2" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#生存分析参数"><i class="fa fa-check"></i><b>11.1.2</b> 生存分析参数</a></li>
<li class="chapter" data-level="11.1.3" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#方差分析参数解释"><i class="fa fa-check"></i><b>11.1.3</b> 方差分析参数解释</a></li>
<li class="chapter" data-level="11.1.4" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#回归分析中常用参数释义"><i class="fa fa-check"></i><b>11.1.4</b> 回归分析中常用参数释义</a></li>
<li class="chapter" data-level="11.1.5" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#常用分布描述"><i class="fa fa-check"></i><b>11.1.5</b> 常用分布描述</a></li>
<li class="chapter" data-level="11.1.6" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#其他统计参数释义"><i class="fa fa-check"></i><b>11.1.6</b> 其他统计参数释义</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#临床研究中常用的统计方法和常见问题"><i class="fa fa-check"></i><b>11.2</b> 临床研究中常用的统计方法和常见问题</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#统计推断与区间估计"><i class="fa fa-check"></i><b>11.2.1</b> 统计推断与区间估计</a></li>
<li class="chapter" data-level="11.2.2" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#统计方法选择"><i class="fa fa-check"></i><b>11.2.2</b> 统计方法选择：</a></li>
<li class="chapter" data-level="11.2.3" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#统计分析中的常见问题"><i class="fa fa-check"></i><b>11.2.3</b> 统计分析中的常见问题</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#差异分析"><i class="fa fa-check"></i><b>11.3</b> 差异分析</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#方差检验与t检验的选择"><i class="fa fa-check"></i><b>11.3.1</b> 方差检验与T检验的选择</a></li>
<li class="chapter" data-level="11.3.2" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#z-分布t检验f检验和卡方检验"><i class="fa fa-check"></i><b>11.3.2</b> Z 分布、T检验、F检验和卡方检验</a></li>
<li class="chapter" data-level="11.3.3" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#t检验"><i class="fa fa-check"></i><b>11.3.3</b> T检验</a></li>
<li class="chapter" data-level="11.3.4" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#方差分析"><i class="fa fa-check"></i><b>11.3.4</b> 方差分析</a></li>
<li class="chapter" data-level="11.3.5" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#卡方检验"><i class="fa fa-check"></i><b>11.3.5</b> 卡方检验</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#多元线性回归"><i class="fa fa-check"></i><b>11.4</b> 多元线性回归</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#多元线性回归的概念和基础公式"><i class="fa fa-check"></i><b>11.4.1</b> 多元线性回归的概念和基础公式</a></li>
<li class="chapter" data-level="11.4.2" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#多元线性回归的本质"><i class="fa fa-check"></i><b>11.4.2</b> 多元线性回归的本质</a></li>
<li class="chapter" data-level="11.4.3" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#回归方程的参数解释"><i class="fa fa-check"></i><b>11.4.3</b> 回归方程的参数解释：</a></li>
<li class="chapter" data-level="11.4.4" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#回归方程的评价指标"><i class="fa fa-check"></i><b>11.4.4</b> 回归方程的评价指标</a></li>
<li class="chapter" data-level="11.4.5" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#回归解释相关参数"><i class="fa fa-check"></i><b>11.4.5</b> 回归解释相关参数：</a></li>
<li class="chapter" data-level="11.4.6" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#回归解释相关补充"><i class="fa fa-check"></i><b>11.4.6</b> 回归解释相关补充：</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#相关检验"><i class="fa fa-check"></i><b>11.5</b> 相关检验</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#相关检验和系数"><i class="fa fa-check"></i><b>11.5.1</b> 相关检验和系数</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#医疗相关检验"><i class="fa fa-check"></i><b>11.6</b> 医疗相关检验</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="Statistics-and-Research-Design.html"><a href="Statistics-and-Research-Design.html#log-rank检验"><i class="fa fa-check"></i><b>11.6.1</b> Log-rank检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html"><i class="fa fa-check"></i><b>12</b> 构筑R package</a>
<ul>
<li class="chapter" data-level="12.1" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#构筑r-package相关参数配置"><i class="fa fa-check"></i><b>12.1</b> 构筑R package相关参数配置</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#创建本地环境并使用renv初始化本地安装环境"><i class="fa fa-check"></i><b>12.1.1</b> 创建本地环境并使用renv初始化本地安装环境</a></li>
<li class="chapter" data-level="12.1.2" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#常用配置"><i class="fa fa-check"></i><b>12.1.2</b> 常用配置</a></li>
<li class="chapter" data-level="12.1.3" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#构建函数"><i class="fa fa-check"></i><b>12.1.3</b> 构建函数</a></li>
<li class="chapter" data-level="12.1.4" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#函数测试"><i class="fa fa-check"></i><b>12.1.4</b> 函数测试</a></li>
<li class="chapter" data-level="12.1.5" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#添加项目内置数据集"><i class="fa fa-check"></i><b>12.1.5</b> 添加项目内置数据集</a></li>
<li class="chapter" data-level="12.1.6" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#添加辅助描述文件"><i class="fa fa-check"></i><b>12.1.6</b> 添加辅助描述文件</a></li>
<li class="chapter" data-level="12.1.7" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#r包整体测试"><i class="fa fa-check"></i><b>12.1.7</b> R包整体测试</a></li>
<li class="chapter" data-level="12.1.8" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#构建及安装r包"><i class="fa fa-check"></i><b>12.1.8</b> 构建及安装R包</a></li>
<li class="chapter" data-level="12.1.9" data-path="id_-Build-R-package.html"><a href="id_-Build-R-package.html#构建后上传到github多平台检查"><i class="fa fa-check"></i><b>12.1.9</b> 构建后上传到github多平台检查</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由bookdown驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">基于 R 的数据处理流程指南</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Data-preprocessing" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">第 3 章</span> 数据预处理<a href="Data-preprocessing.html#Data-preprocessing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>该专题涉及到数据抽样、数据清洗、重组、转换及衍生及特征处理</strong></p>
<div id="数据抽取" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> 数据抽取<a href="Data-preprocessing.html#数据抽取" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>样本中的缺失值分布（频率）也要与全集一致。</li>
<li>针对稀有事件抽样时，由于人为增加了目标事件的浓度，导致样本中的事件和非事件的比例与全集不一致，所以需要在建模过程中，对新样本使用加权。</li>
<li>评估抽样设计方法与下游工作链的承接关系</li>
<li>基于抽样数据做规模分析评估（可信度），保证后续分析的有效性</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="Data-preprocessing.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法1：within</span></span>
<span id="cb15-2"><a href="Data-preprocessing.html#cb15-2" aria-hidden="true" tabindex="-1"></a>dragons <span class="ot">&lt;-</span> <span class="fu">within</span>(dragons, sample <span class="ot">&lt;-</span> <span class="fu">factor</span>(mountainRange<span class="sc">:</span>site))</span>
<span id="cb15-3"><a href="Data-preprocessing.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="Data-preprocessing.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法2：</span></span>
<span id="cb15-5"><a href="Data-preprocessing.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 简单随机抽样：</span></span>
<span id="cb15-6"><a href="Data-preprocessing.html#cb15-6" aria-hidden="true" tabindex="-1"></a>sample（x,n,replace<span class="ot">=</span>T）</span>
<span id="cb15-7"><a href="Data-preprocessing.html#cb15-7" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">sample_n</span>((tbl, size, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-8"><a href="Data-preprocessing.html#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="Data-preprocessing.html#cb15-9" aria-hidden="true" tabindex="-1"></a>参数说明：tbl数据，size选取的数据行数，<span class="at">replace=</span>true<span class="sc">/</span>false是否替换样本（主要参数）</span>
<span id="cb15-10"><a href="Data-preprocessing.html#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="Data-preprocessing.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 分层抽样：</span></span>
<span id="cb15-12"><a href="Data-preprocessing.html#cb15-12" aria-hidden="true" tabindex="-1"></a>strata（data，<span class="at">stratanames=</span><span class="cn">NULL</span>,size,<span class="at">method=</span><span class="fu">c</span>(<span class="st">&quot;srswor&quot;</span>,<span class="st">&quot;srswr&quot;</span>,<span class="st">&quot;poisson&quot;</span>,<span class="st">&quot;systematic&quot;</span>),pik,<span class="at">description=</span>FALSE）</span>
<span id="cb15-13"><a href="Data-preprocessing.html#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="Data-preprocessing.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 整群抽样：</span></span>
<span id="cb15-15"><a href="Data-preprocessing.html#cb15-15" aria-hidden="true" tabindex="-1"></a>cluster（data，clusteraname,size,<span class="at">method=</span><span class="fu">c</span>(<span class="st">&quot;srswor&quot;</span>,<span class="st">&quot;srswr&quot;</span>,<span class="st">&quot;poisson&quot;</span>,<span class="st">&quot;systematic&quot;</span>),pik,<span class="at">description=</span>FALSE）</span></code></pre></div>
</div>
<div id="数据清洗" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> 数据清洗<a href="Data-preprocessing.html#数据清洗" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="选择数据子集" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> 选择数据子集<a href="Data-preprocessing.html#选择数据子集" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>根据项目方案中不同策略人群和研究终点来设计不同的取样数据子集</li>
<li>数据子集的确定应使用统一的函数构造体系，并且保存成对应的rds文件方便后续读取</li>
<li>在此步骤提取的数据子集为粗子集</li>
</ul>
</div>
<div id="数据去重" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> 数据去重<a href="Data-preprocessing.html#数据去重" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="Data-preprocessing.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 数据去重：</span></span>
<span id="cb16-2"><a href="Data-preprocessing.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>()</span>
<span id="cb16-3"><a href="Data-preprocessing.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>()</span>
<span id="cb16-4"><a href="Data-preprocessing.html#cb16-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">n_distinct</span>()</span>
<span id="cb16-5"><a href="Data-preprocessing.html#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="Data-preprocessing.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 删除重复数据： </span></span>
<span id="cb16-7"><a href="Data-preprocessing.html#cb16-7" aria-hidden="true" tabindex="-1"></a>new_data1 <span class="ot">&lt;-</span> <span class="fu">unique</span> (data )   <span class="sc">---</span>删除的为所有字段均重复的记录</span>
<span id="cb16-8"><a href="Data-preprocessing.html#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="Data-preprocessing.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="do">## duplicated</span></span>
<span id="cb16-10"><a href="Data-preprocessing.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用这个函数返回的是重复元素的下表或者布尔逻辑；</span></span>
<span id="cb16-11"><a href="Data-preprocessing.html#cb16-11" aria-hidden="true" tabindex="-1"></a>rattlerdups<span class="ot">=</span><span class="fu">duplicated</span>(rattler[, <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)])</span>
<span id="cb16-12"><a href="Data-preprocessing.html#cb16-12" aria-hidden="true" tabindex="-1"></a>rattler <span class="ot">&lt;-</span>rattler[<span class="sc">!</span>rattlerdups, ]</span>
<span id="cb16-13"><a href="Data-preprocessing.html#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="Data-preprocessing.html#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用dplyr包内置的distinct()进行去重：</span></span>
<span id="cb16-15"><a href="Data-preprocessing.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># added to a chain of pipes (e.g. data cleaning)</span></span>
<span id="cb16-16"><a href="Data-preprocessing.html#cb16-16" aria-hidden="true" tabindex="-1"></a>obs <span class="sc">%&gt;%</span> </span>
<span id="cb16-17"><a href="Data-preprocessing.html#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">across</span>(<span class="sc">-</span>recordID), <span class="co"># reduces data frame to only unique rows (keeps first one of any duplicates)</span></span>
<span id="cb16-18"><a href="Data-preprocessing.html#cb16-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb16-19"><a href="Data-preprocessing.html#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="Data-preprocessing.html#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用 janitor来使用get_dupes()来实现复杂去重，实际上是观测重叠值；</span></span>
<span id="cb16-21"><a href="Data-preprocessing.html#cb16-21" aria-hidden="true" tabindex="-1"></a>obs <span class="sc">%&gt;%</span> </span>
<span id="cb16-22"><a href="Data-preprocessing.html#cb16-22" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">get_dupes</span>() <span class="do">## 全部列重复；</span></span>
<span id="cb16-23"><a href="Data-preprocessing.html#cb16-23" aria-hidden="true" tabindex="-1"></a>obs <span class="sc">%&gt;%</span> </span>
<span id="cb16-24"><a href="Data-preprocessing.html#cb16-24" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">get_dupes</span>(<span class="sc">-</span>recordID)   <span class="do">##除recordID 以外的列均重复</span></span>
<span id="cb16-25"><a href="Data-preprocessing.html#cb16-25" aria-hidden="true" tabindex="-1"></a>obs <span class="sc">%&gt;%</span> </span>
<span id="cb16-26"><a href="Data-preprocessing.html#cb16-26" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">get_dupes</span>(name, purpose) <span class="do">## 仅name和purpose 列重复；</span></span></code></pre></div>
</div>
<div id="缺失值处理" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> 缺失值处理<a href="Data-preprocessing.html#缺失值处理" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>从业务逻辑和商业意义上，分析缺失原因，是否需要补全缺失值，应该如何做。</li>
<li>直接删除带有缺失值的观察对象（或称数据元组），适用于带有缺失值的数据元组比例很少的情况。</li>
<li>直接删除有大量缺失的变量，适用于缺失值占比超过50%，且不具备商业意义。</li>
<li>对缺失值进行替换，利用全集中的代表属性（众数、均值、MAX、MIN等），或者人为定义替换。</li>
<li>对缺失值进行赋值，用回归、决策树、贝叶斯定理等模型去预测缺失值。
#### 删除缺失：</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="Data-preprocessing.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">###################################### 缺失值删除： ######################</span></span>
<span id="cb17-2"><a href="Data-preprocessing.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 去除包含缺失值的行：</span></span>
<span id="cb17-3"><a href="Data-preprocessing.html#cb17-3" aria-hidden="true" tabindex="-1"></a>na.omit 函数语法： <span class="fu">na.omit</span> (x)</span>
<span id="cb17-4"><a href="Data-preprocessing.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">drop_na</span>(case_id, date_onset, age)  <span class="do">## 删除指定缺失值的行：</span></span>
<span id="cb17-5"><a href="Data-preprocessing.html#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="Data-preprocessing.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 删除包含所有含0的值或者行：</span></span>
<span id="cb17-7"><a href="Data-preprocessing.html#cb17-7" aria-hidden="true" tabindex="-1"></a>row_sub <span class="ot">=</span> <span class="fu">apply</span>(nall1, <span class="dv">1</span>, <span class="cf">function</span>(row) <span class="fu">all</span>(row <span class="sc">!=</span><span class="dv">0</span> ))      </span>
<span id="cb17-8"><a href="Data-preprocessing.html#cb17-8" aria-hidden="true" tabindex="-1"></a>nall1<span class="sc">$</span>.[row_sub]   </span>
<span id="cb17-9"><a href="Data-preprocessing.html#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="Data-preprocessing.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除某些列都是na的行，借助if_all()也可以；</span></span>
<span id="cb17-11"><a href="Data-preprocessing.html#cb17-11" aria-hidden="true" tabindex="-1"></a>df_dup <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">if_all</span>(<span class="fu">where</span>(is.numeric),is.na))                </span>
<span id="cb17-12"><a href="Data-preprocessing.html#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="Data-preprocessing.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用filter()定向删除na值：               </span></span>
<span id="cb17-14"><a href="Data-preprocessing.html#cb17-14" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">filter</span>(linelist, <span class="sc">!</span><span class="fu">is.na</span>(case_id))               </span>
<span id="cb17-15"><a href="Data-preprocessing.html#cb17-15" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb17-16"><a href="Data-preprocessing.html#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="do">#################################### 缺失值替换 ######################## </span></span>
<span id="cb17-17"><a href="Data-preprocessing.html#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 重新对缺失值赋值：</span></span>
<span id="cb17-18"><a href="Data-preprocessing.html#cb17-18" aria-hidden="true" tabindex="-1"></a>elmat[<span class="fu">is.na</span>(elmat)]<span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb17-19"><a href="Data-preprocessing.html#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="Data-preprocessing.html#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 缺失值替换：</span></span>
<span id="cb17-21"><a href="Data-preprocessing.html#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="do">## replace_na()仅能针对单行进行匹配：</span></span>
<span id="cb17-22"><a href="Data-preprocessing.html#cb17-22" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>   <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span>
<span id="cb17-23"><a href="Data-preprocessing.html#cb17-23" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">na_if</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span>
<span id="cb17-24"><a href="Data-preprocessing.html#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="Data-preprocessing.html#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用mutate_at()来指定列进行条件替换：</span></span>
<span id="cb17-26"><a href="Data-preprocessing.html#cb17-26" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb17-27"><a href="Data-preprocessing.html#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="st">&quot;高血压&quot;</span>, <span class="st">&quot;心脏病&quot;</span>, <span class="st">&quot;糖尿病&quot;</span>), <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="dv">0</span>)) </span>
<span id="cb17-28"><a href="Data-preprocessing.html#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="Data-preprocessing.html#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 全表的缺失值替换：                </span></span>
<span id="cb17-30"><a href="Data-preprocessing.html#cb17-30" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">replace</span>(<span class="fu">is.na</span>(.),<span class="dv">0</span>)</span>
<span id="cb17-31"><a href="Data-preprocessing.html#cb17-31" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb17-32"><a href="Data-preprocessing.html#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 逻辑判断条件下的na值定义：</span></span>
<span id="cb17-33"><a href="Data-preprocessing.html#cb17-33" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb17-34"><a href="Data-preprocessing.html#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp =</span> <span class="fu">replace</span>(temp, temp <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="cn">NA</span>))</span>
<span id="cb17-35"><a href="Data-preprocessing.html#cb17-35" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb17-36"><a href="Data-preprocessing.html#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用forcats进行缺失值填充：</span></span>
<span id="cb17-37"><a href="Data-preprocessing.html#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">hospital =</span> forcats<span class="sc">::</span><span class="fu">fct_explicit_na</span>(hospital))</span>
<span id="cb17-38"><a href="Data-preprocessing.html#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">delay_cat =</span> forcats<span class="sc">::</span><span class="fu">fct_explicit_na</span>(delay_cat, <span class="at">na_level =</span> <span class="st">&quot;Missing delay&quot;</span>))</span></code></pre></div>
<div id="缺失值处理r包zoo" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> 缺失值处理R包：ZOO<a href="Data-preprocessing.html#缺失值处理r包zoo" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="Data-preprocessing.html#cb18-1" aria-hidden="true" tabindex="-1"></a>RMSE <span class="ot">&lt;-</span> <span class="cf">function</span>(sim, obs){</span>
<span id="cb18-2"><a href="Data-preprocessing.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">sum</span>((sim<span class="sc">-</span>obs)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">length</span>(sim))</span>
<span id="cb18-3"><a href="Data-preprocessing.html#cb18-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-4"><a href="Data-preprocessing.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb18-5"><a href="Data-preprocessing.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb18-6"><a href="Data-preprocessing.html#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="Data-preprocessing.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&quot;https://userpage.fu-berlin.de/soga/300/30100_data_sets/NA_datasets.Rdata&quot;</span>))</span>
<span id="cb18-8"><a href="Data-preprocessing.html#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="Data-preprocessing.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(temp.sample, </span>
<span id="cb18-10"><a href="Data-preprocessing.html#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&#39;Weather station Berlin-Dahlem&#39;</span>, <span class="at">ylab =</span> <span class="st">&quot;°C&quot;</span>)</span>
<span id="cb18-11"><a href="Data-preprocessing.html#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="Data-preprocessing.html#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(temp.NA, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="st">&quot;°C&quot;</span>), </span>
<span id="cb18-13"><a href="Data-preprocessing.html#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> <span class="fl">0.85</span>,</span>
<span id="cb18-14"><a href="Data-preprocessing.html#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, </span>
<span id="cb18-15"><a href="Data-preprocessing.html#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex =</span> <span class="fl">0.3</span>, </span>
<span id="cb18-16"><a href="Data-preprocessing.html#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb18-17"><a href="Data-preprocessing.html#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="Data-preprocessing.html#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="Data-preprocessing.html#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">is.na</span>(temp.NA))</span>
<span id="cb18-20"><a href="Data-preprocessing.html#cb18-20" aria-hidden="true" tabindex="-1"></a>na.perc <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(temp.NA))<span class="sc">/</span><span class="fu">length</span>(temp.sample),<span class="dv">3</span>)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb18-21"><a href="Data-preprocessing.html#cb18-21" aria-hidden="true" tabindex="-1"></a>na.perc</span>
<span id="cb18-22"><a href="Data-preprocessing.html#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="Data-preprocessing.html#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="do">## IMPUTING ##</span></span>
<span id="cb18-24"><a href="Data-preprocessing.html#cb18-24" aria-hidden="true" tabindex="-1"></a>temp.NA.imp <span class="ot">&lt;-</span> <span class="fu">na.aggregate</span>(temp.NA, <span class="at">FUN =</span> mean, as.yearmon)</span>
<span id="cb18-25"><a href="Data-preprocessing.html#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="Data-preprocessing.html#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 除了na.aggregate外，还有另外的几种形式：￥￥￥￥￥￥￥￥￥</span></span>
<span id="cb18-27"><a href="Data-preprocessing.html#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="do">## na.locf()：</span></span>
<span id="cb18-28"><a href="Data-preprocessing.html#cb18-28" aria-hidden="true" tabindex="-1"></a>用最近的非NA取代每个NA的通用函数。</span>
<span id="cb18-29"><a href="Data-preprocessing.html#cb18-29" aria-hidden="true" tabindex="-1"></a>对于每个个体，缺失的值将由该变量的最后一个观察值替换。</span>
<span id="cb18-30"><a href="Data-preprocessing.html#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="do">## na.StructTS()</span></span>
<span id="cb18-31"><a href="Data-preprocessing.html#cb18-31" aria-hidden="true" tabindex="-1"></a>用季节卡尔曼滤波器填充NA值的泛型函数。</span>
<span id="cb18-32"><a href="Data-preprocessing.html#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co"># na.interp()</span></span>
<span id="cb18-33"><a href="Data-preprocessing.html#cb18-33" aria-hidden="true" tabindex="-1"></a>对非季节序列采用线性插值，对季节序列进行周期性stl分解，替换缺失值。</span>
<span id="cb18-34"><a href="Data-preprocessing.html#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="Data-preprocessing.html#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="do">## ERROR ##</span></span>
<span id="cb18-36"><a href="Data-preprocessing.html#cb18-36" aria-hidden="true" tabindex="-1"></a>rmse.NA <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(temp.NA.imp, temp.sample)</span>
<span id="cb18-37"><a href="Data-preprocessing.html#cb18-37" aria-hidden="true" tabindex="-1"></a>rmse.NA</span>
<span id="cb18-38"><a href="Data-preprocessing.html#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="Data-preprocessing.html#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="do">## PLOTTING ##</span></span>
<span id="cb18-40"><a href="Data-preprocessing.html#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(temp.NA.imp, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="st">&quot;°C&quot;</span>), </span>
<span id="cb18-41"><a href="Data-preprocessing.html#cb18-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;na.aggregate()&quot;</span>,</span>
<span id="cb18-42"><a href="Data-preprocessing.html#cb18-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> <span class="fl">0.85</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb18-43"><a href="Data-preprocessing.html#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(temp.NA,</span>
<span id="cb18-44"><a href="Data-preprocessing.html#cb18-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.3</span>, </span>
<span id="cb18-45"><a href="Data-preprocessing.html#cb18-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb18-46"><a href="Data-preprocessing.html#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">2013.5</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">&#39;RMSE: &#39;</span>, <span class="fu">round</span>(rmse.NA,<span class="dv">4</span>)), <span class="at">cex =</span> <span class="fl">0.85</span>)</span>
<span id="cb18-47"><a href="Data-preprocessing.html#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="at">legend =</span> <span class="st">&#39;Imputed values&#39;</span>, </span>
<span id="cb18-48"><a href="Data-preprocessing.html#cb18-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">cex =</span> <span class="fl">0.65</span>)</span>
<span id="cb18-49"><a href="Data-preprocessing.html#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="Data-preprocessing.html#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="do">## IMPUTING ##</span></span>
<span id="cb18-51"><a href="Data-preprocessing.html#cb18-51" aria-hidden="true" tabindex="-1"></a>temp.NA.imp <span class="ot">&lt;-</span> <span class="fu">na.locf</span>(temp.NA, <span class="at">fromLast =</span> F)</span>
<span id="cb18-52"><a href="Data-preprocessing.html#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="do">## ERROR ##</span></span>
<span id="cb18-53"><a href="Data-preprocessing.html#cb18-53" aria-hidden="true" tabindex="-1"></a>rmse.NA <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(temp.NA.imp, temp.sample)</span>
<span id="cb18-54"><a href="Data-preprocessing.html#cb18-54" aria-hidden="true" tabindex="-1"></a>rmse.NA</span>
<span id="cb18-55"><a href="Data-preprocessing.html#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="Data-preprocessing.html#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="do">## PLOTTING ##</span></span>
<span id="cb18-57"><a href="Data-preprocessing.html#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(temp.NA.imp, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="st">&quot;°C&quot;</span>), </span>
<span id="cb18-58"><a href="Data-preprocessing.html#cb18-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;na.locf()&quot;</span>,</span>
<span id="cb18-59"><a href="Data-preprocessing.html#cb18-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> <span class="fl">0.85</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb18-60"><a href="Data-preprocessing.html#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(temp.NA,</span>
<span id="cb18-61"><a href="Data-preprocessing.html#cb18-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, </span>
<span id="cb18-62"><a href="Data-preprocessing.html#cb18-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.3</span>, </span>
<span id="cb18-63"><a href="Data-preprocessing.html#cb18-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb18-64"><a href="Data-preprocessing.html#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">2013.5</span>, <span class="sc">-</span><span class="dv">10</span>, </span>
<span id="cb18-65"><a href="Data-preprocessing.html#cb18-65" aria-hidden="true" tabindex="-1"></a>     <span class="fu">paste</span>(<span class="st">&#39;RMSE: &#39;</span>, <span class="fu">round</span>(rmse.NA,<span class="dv">4</span>)), </span>
<span id="cb18-66"><a href="Data-preprocessing.html#cb18-66" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.85</span>)</span>
<span id="cb18-67"><a href="Data-preprocessing.html#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="at">legend =</span> <span class="st">&#39;Imputed values&#39;</span>, </span>
<span id="cb18-68"><a href="Data-preprocessing.html#cb18-68" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">cex =</span> <span class="fl">0.65</span>)</span>
<span id="cb18-69"><a href="Data-preprocessing.html#cb18-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-70"><a href="Data-preprocessing.html#cb18-70" aria-hidden="true" tabindex="-1"></a><span class="do">## IMPUTING ##</span></span>
<span id="cb18-71"><a href="Data-preprocessing.html#cb18-71" aria-hidden="true" tabindex="-1"></a>temp.NA.imp <span class="ot">&lt;-</span> <span class="fu">na.interp</span>(temp.NA)</span>
<span id="cb18-72"><a href="Data-preprocessing.html#cb18-72" aria-hidden="true" tabindex="-1"></a><span class="do">## ERROR ##</span></span>
<span id="cb18-73"><a href="Data-preprocessing.html#cb18-73" aria-hidden="true" tabindex="-1"></a>rmse.NA <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(temp.NA.imp, temp.sample)</span>
<span id="cb18-74"><a href="Data-preprocessing.html#cb18-74" aria-hidden="true" tabindex="-1"></a>rmse.NA</span>
<span id="cb18-75"><a href="Data-preprocessing.html#cb18-75" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.982686</span></span>
<span id="cb18-76"><a href="Data-preprocessing.html#cb18-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-77"><a href="Data-preprocessing.html#cb18-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-78"><a href="Data-preprocessing.html#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="do">## PLOTTING ##</span></span>
<span id="cb18-79"><a href="Data-preprocessing.html#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(temp.NA.imp, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="st">&quot;°C&quot;</span>), </span>
<span id="cb18-80"><a href="Data-preprocessing.html#cb18-80" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;na.interp()&quot;</span>,</span>
<span id="cb18-81"><a href="Data-preprocessing.html#cb18-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> <span class="fl">0.85</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb18-82"><a href="Data-preprocessing.html#cb18-82" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(temp.NA,</span>
<span id="cb18-83"><a href="Data-preprocessing.html#cb18-83" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.3</span>, </span>
<span id="cb18-84"><a href="Data-preprocessing.html#cb18-84" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb18-85"><a href="Data-preprocessing.html#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">2013.5</span>, <span class="sc">-</span><span class="dv">10</span>, </span>
<span id="cb18-86"><a href="Data-preprocessing.html#cb18-86" aria-hidden="true" tabindex="-1"></a>     <span class="fu">paste</span>(<span class="st">&#39;RMSE: &#39;</span>, <span class="fu">round</span>(rmse.NA,<span class="dv">4</span>)), <span class="at">cex =</span> <span class="fl">0.85</span>)</span>
<span id="cb18-87"><a href="Data-preprocessing.html#cb18-87" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="at">legend =</span> <span class="st">&#39;Imputed values&#39;</span>, </span>
<span id="cb18-88"><a href="Data-preprocessing.html#cb18-88" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">cex =</span> <span class="fl">0.65</span>)</span></code></pre></div>
</div>
<div id="缺失值评估" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> 缺失值评估<a href="Data-preprocessing.html#缺失值评估" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="Data-preprocessing.html#cb19-1" aria-hidden="true" tabindex="-1"></a>参见<span class="sc">:</span>https<span class="sc">:</span><span class="er">//</span>zhuanlan.zhihu.com<span class="sc">/</span>p<span class="sc">/</span><span class="dv">455056143</span></span>
<span id="cb19-2"><a href="Data-preprocessing.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 常用函数:</span></span>
<span id="cb19-3"><a href="Data-preprocessing.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>()</span>
<span id="cb19-4"><a href="Data-preprocessing.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>()</span>
<span id="cb19-5"><a href="Data-preprocessing.html#cb19-5" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span>skim</span>
<span id="cb19-6"><a href="Data-preprocessing.html#cb19-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>() <span class="do">## 展示套叠数据格式；</span></span>
<span id="cb19-7"><a href="Data-preprocessing.html#cb19-7" aria-hidden="true" tabindex="-1"></a>dplur<span class="sc">::</span><span class="fu">ff_glimpse</span>() <span class="do">## 展示数据全貌，包含缺失值和summary的汇总；</span></span>
<span id="cb19-8"><a href="Data-preprocessing.html#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="Data-preprocessing.html#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="Data-preprocessing.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用visdat:</span></span>
<span id="cb19-11"><a href="Data-preprocessing.html#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb19-12"><a href="Data-preprocessing.html#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_dat</span>(airquality)</span>
<span id="cb19-13"><a href="Data-preprocessing.html#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="Data-preprocessing.html#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用可视化方法探索缺失值的存在：</span></span>
<span id="cb19-15"><a href="Data-preprocessing.html#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb19-16"><a href="Data-preprocessing.html#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="Data-preprocessing.html#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, </span>
<span id="cb19-18"><a href="Data-preprocessing.html#cb19-18" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, </span>
<span id="cb19-19"><a href="Data-preprocessing.html#cb19-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb19-20"><a href="Data-preprocessing.html#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>()</span>
<span id="cb19-21"><a href="Data-preprocessing.html#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="Data-preprocessing.html#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> 分面查看缺失值：</span>
<span id="cb19-23"><a href="Data-preprocessing.html#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, </span>
<span id="cb19-24"><a href="Data-preprocessing.html#cb19-24" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, </span>
<span id="cb19-25"><a href="Data-preprocessing.html#cb19-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb19-26"><a href="Data-preprocessing.html#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>() <span class="sc">+</span> </span>
<span id="cb19-27"><a href="Data-preprocessing.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Month) <span class="sc">+</span> </span>
<span id="cb19-28"><a href="Data-preprocessing.html#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dark</span>()</span>
<span id="cb19-29"><a href="Data-preprocessing.html#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="Data-preprocessing.html#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> 统计缺失值：</span>
<span id="cb19-31"><a href="Data-preprocessing.html#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="fu">pct_miss</span>(linelist)</span>
<span id="cb19-32"><a href="Data-preprocessing.html#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="fu">pct_complete_case</span>(linelist)</span></code></pre></div>
<div id="一致化处理" class="section level5 hasAnchor" number="3.2.3.2.1">
<h5><span class="header-section-number">3.2.3.2.1</span> 3.2.5 一致化处理<a href="Data-preprocessing.html#一致化处理" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li><p>数据集中会存在某一个数据列的数据至标准不一致或命名规则不一致的情况，可以使用分列功能将不一致的数据列中的数据值进行拆分。例如将薪水7k-9k划分为最高薪资（9k）和最低薪资（7k）。</p></li>
<li><p>标准化处理：</p>
<p>对于很多模型，如线性回归、逻辑回归、Kmeans聚类等，需要计算不同特征的系数，或者计算样本距离。</p>
<p>这种情况下，如果不同特征的数值量级差的特别大，会严重影响系数和距离的计算，甚至这种计算都会失去意义；所以在建模前必须要做的就是要去量纲，做标准化处理。</p>
<p>当然有些模型是不需要做数据标准化处理的，如决策树、随机森林、朴素贝叶斯等。</p></li>
<li><p>字符型数据转化成数值性数据</p></li>
<li><p>将分类变量转为虚拟亚变量，实现one-hot编码</p></li>
</ul>
</div>
<div id="异常值处理" class="section level5 hasAnchor" number="3.2.3.2.2">
<h5><span class="header-section-number">3.2.3.2.2</span> 3.2.6 异常值处理<a href="Data-preprocessing.html#异常值处理" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li>看数据是否处于异常，可以用 3σ原则，PCA，箱线图等等，至于是否要处理也要看建模的目标对于异常值的考虑。</li>
</ul>
</div>
</div>
</div>
<div id="一致化处理-1" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> 一致化处理<a href="Data-preprocessing.html#一致化处理-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<pre><code>- 数据集中会存在某一个数据列的数据至标准不一致或命名规则不一致的情况，可以使用分列功能将不一致的数据列中的数据值进行拆分。例如将薪水7k-9k划分为最高薪资（9k）和最低薪资（7k）。

## 标准化处理：
  对于很多模型，如线性回归、逻辑回归、Kmeans聚类等，需要计算不同特征的系数，或者计算样本距离。
  这种情况下，如果不同特征的数值量级差的特别大，会严重影响系数和距离的计算，甚至这种计算都会失去意义；所以在建模前必须要做的就是要去量纲，做标准化处理。
  当然有些模型是不需要做数据标准化处理的，如决策树、随机森林、朴素贝叶斯等。

- 字符型数据转化成数值性数据

- 将分类变量转为虚拟亚变量，实现one-hot编码</code></pre>
</div>
<div id="异常值处理-1" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> 异常值处理<a href="Data-preprocessing.html#异常值处理-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<pre><code>看数据是否处于异常，可以用 3σ原则，PCA，箱线图等等    ，至于是否要处理也要看建模的目标对于异常值的考虑。</code></pre>
<div id="处理零值数据" class="section level4 hasAnchor" number="3.2.5.1">
<h4><span class="header-section-number">3.2.5.1</span> 1.6.1 处理零值数据<a href="Data-preprocessing.html#处理零值数据" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="Data-preprocessing.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">##1.1 去除那些每个值都是零的行</span></span>
<span id="cb22-2"><a href="Data-preprocessing.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="do">##转换思维，每个数据都为0的行，则该行的和也为0</span></span>
<span id="cb22-3"><a href="Data-preprocessing.html#cb22-3" aria-hidden="true" tabindex="-1"></a>data1<span class="ot">=</span>data[<span class="fu">which</span>(<span class="fu">rowSums</span>(data) <span class="sc">&gt;</span> <span class="dv">0</span>),]</span>
<span id="cb22-4"><a href="Data-preprocessing.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data1)</span>
<span id="cb22-5"><a href="Data-preprocessing.html#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="Data-preprocessing.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="do">##1.2 去除那些存在值为零的行</span></span>
<span id="cb22-7"><a href="Data-preprocessing.html#cb22-7" aria-hidden="true" tabindex="-1"></a>data2<span class="ot">=</span>data[<span class="fu">which</span>(<span class="fu">rowSums</span>(data<span class="sc">==</span><span class="dv">0</span>)<span class="sc">==</span><span class="dv">0</span>),]</span>
<span id="cb22-8"><a href="Data-preprocessing.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data2)</span>
<span id="cb22-9"><a href="Data-preprocessing.html#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="Data-preprocessing.html#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="do">##换一种思路，将为零的值替换为NA</span></span>
<span id="cb22-11"><a href="Data-preprocessing.html#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#2.1 把０替换成NA,然后按照处理缺失值的办法，</span></span>
<span id="cb22-12"><a href="Data-preprocessing.html#cb22-12" aria-hidden="true" tabindex="-1"></a>data0[data0<span class="sc">==</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb22-13"><a href="Data-preprocessing.html#cb22-13" aria-hidden="true" tabindex="-1"></a>data3<span class="ot">=</span><span class="fu">na.omit</span>(data0)<span class="do">##去除所有含NA的行</span></span>
<span id="cb22-14"><a href="Data-preprocessing.html#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data3)</span>
<span id="cb22-15"><a href="Data-preprocessing.html#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="Data-preprocessing.html#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="do">##3.1 使用complete()函数自主操作</span></span>
<span id="cb22-17"><a href="Data-preprocessing.html#cb22-17" aria-hidden="true" tabindex="-1"></a>data4<span class="ot">=</span>data0[<span class="fu">complete.cases</span>(data0),]</span>
<span id="cb22-18"><a href="Data-preprocessing.html#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="Data-preprocessing.html#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="do">##3.2 去除前六列含有NA的z值，可自由设置</span></span>
<span id="cb22-20"><a href="Data-preprocessing.html#cb22-20" aria-hidden="true" tabindex="-1"></a>data5<span class="ot">=</span>data0[<span class="fu">complete.cases</span>(data0[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]),]</span>
<span id="cb22-21"><a href="Data-preprocessing.html#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="Data-preprocessing.html#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="do">###4.1 x[is.na(x)] &lt;- 0使用该函数对NA值进行赋值</span></span>
<span id="cb22-23"><a href="Data-preprocessing.html#cb22-23" aria-hidden="true" tabindex="-1"></a>data0<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;eSet.csv&quot;</span>,<span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb22-24"><a href="Data-preprocessing.html#cb22-24" aria-hidden="true" tabindex="-1"></a>data0[data0<span class="sc">==</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb22-25"><a href="Data-preprocessing.html#cb22-25" aria-hidden="true" tabindex="-1"></a>data0[<span class="fu">is.na</span>(data0)]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb22-26"><a href="Data-preprocessing.html#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="Data-preprocessing.html#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="do">##4.2 可以把NA赋值给任何值,相互换</span></span>
<span id="cb22-28"><a href="Data-preprocessing.html#cb22-28" aria-hidden="true" tabindex="-1"></a>data0[data0<span class="sc">==</span><span class="dv">111</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb22-29"><a href="Data-preprocessing.html#cb22-29" aria-hidden="true" tabindex="-1"></a>data0[<span class="fu">is.na</span>(data0)]<span class="ot">&lt;-</span><span class="st">&quot;h&quot;</span></span></code></pre></div>
</div>
</div>
<div id="插值填补" class="section level3 hasAnchor" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> 插值填补<a href="Data-preprocessing.html#插值填补" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="Data-preprocessing.html#cb23-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(patient_id) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(result_datetime) <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="Data-preprocessing.html#cb23-2" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">fill</span>(lab_fp_6,<span class="at">.direction =</span><span class="st">&quot;updown&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="数据重组与转换" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> 数据重组与转换<a href="Data-preprocessing.html#数据重组与转换" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="数据修改-数据增加与删除" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> 数据修改-数据增加与删除<a href="Data-preprocessing.html#数据修改-数据增加与删除" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="数据增加" class="section level4 hasAnchor" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> 数据增加：<a href="Data-preprocessing.html#数据增加" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="Data-preprocessing.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 添加行：dplyr::add_row()</span></span>
<span id="cb24-2"><a href="Data-preprocessing.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用.before和.after.指定要添加的行的位置。.before = 3将新行放在当前第三行之前。默认行为是将行添加到末尾。未指定的列将留空 ( NA)。</span></span>
<span id="cb24-3"><a href="Data-preprocessing.html#cb24-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="Data-preprocessing.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">row_num =</span> <span class="dv">666</span>,</span>
<span id="cb24-5"><a href="Data-preprocessing.html#cb24-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">case_id =</span> <span class="st">&quot;abc&quot;</span>,</span>
<span id="cb24-6"><a href="Data-preprocessing.html#cb24-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">generation =</span> <span class="dv">4</span>,</span>
<span id="cb24-7"><a href="Data-preprocessing.html#cb24-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">infection date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-10-10&quot;</span>),</span>
<span id="cb24-8"><a href="Data-preprocessing.html#cb24-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">.before =</span> <span class="dv">2</span>)</span>
<span id="cb24-9"><a href="Data-preprocessing.html#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="Data-preprocessing.html#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 添加新列：</span></span>
<span id="cb24-11"><a href="Data-preprocessing.html#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">transform</span>(BOD,<span class="at">ZIMU=</span>(<span class="fu">paste0</span>(<span class="st">&quot;A&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)))</span>
<span id="cb24-12"><a href="Data-preprocessing.html#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="Data-preprocessing.html#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用tribble()生成新的数据：</span></span>
<span id="cb24-14"><a href="Data-preprocessing.html#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 只需要添加一个~x1即可；</span></span>
<span id="cb24-15"><a href="Data-preprocessing.html#cb24-15" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>( <span class="sc">~</span>x1, <span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>) </span>
<span id="cb24-16"><a href="Data-preprocessing.html#cb24-16" aria-hidden="true" tabindex="-1"></a> </span></code></pre></div>
</div>
<div id="数据合并" class="section level4 hasAnchor" number="3.3.1.2">
<h4><span class="header-section-number">3.3.1.2</span> 数据合并：<a href="Data-preprocessing.html#数据合并" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="Data-preprocessing.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 左右列合并：</span></span>
<span id="cb25-2"><a href="Data-preprocessing.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 常用包括左右链接、全链接、内链接、半链接和反链接；</span></span>
<span id="cb25-3"><a href="Data-preprocessing.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(x,y,by) <span class="do">##仅保留与左侧相对应的行</span></span>
<span id="cb25-4"><a href="Data-preprocessing.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">right</span>(x,y,by)</span>
<span id="cb25-5"><a href="Data-preprocessing.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(x,y,by) <span class="do">## 保留全部对应的行，对不上为空值；</span></span>
<span id="cb25-6"><a href="Data-preprocessing.html#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(x,y,by) <span class="do">## 保留相同对应的行，对不上删除；</span></span>
<span id="cb25-7"><a href="Data-preprocessing.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">semi_join</span>(x,y,by) <span class="do">##  与内链接类似；</span></span>
<span id="cb25-8"><a href="Data-preprocessing.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(x,y,by)  <span class="do">## </span></span>
<span id="cb25-9"><a href="Data-preprocessing.html#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="Data-preprocessing.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 多个表相互链接：</span></span>
<span id="cb25-11"><a href="Data-preprocessing.html#cb25-11" aria-hidden="true" tabindex="-1"></a>前面讲过，reduce可以实现逐步迭代的功能，因此可以使用reduce来逐步实现累计合并的功能：</span>
<span id="cb25-12"><a href="Data-preprocessing.html#cb25-12" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">&quot;./da/&quot;</span>,<span class="at">pattern =</span> <span class="st">&quot;xlsx&quot;</span>, <span class="at">full.names =</span><span class="cn">TRUE</span>)</span>
<span id="cb25-13"><a href="Data-preprocessing.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(files,read_xlsx) <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(full_join,<span class="at">by =</span> <span class="st">&quot;name&quot;</span>)</span>
<span id="cb25-14"><a href="Data-preprocessing.html#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 单个表多个sheet链接：</span></span>
<span id="cb25-15"><a href="Data-preprocessing.html#cb25-15" aria-hidden="true" tabindex="-1"></a>path  <span class="ot">=</span> <span class="st">&quot;./yue.xlsx&quot;</span></span>
<span id="cb25-16"><a href="Data-preprocessing.html#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="fu">excel_sheet</span>(path)),<span class="sc">~</span> read<span class="sc">-</span><span class="fu">xlsx</span>(path,<span class="at">sheet =</span> .x)<span class="er">)</span> <span class="sc">%&gt;%</span> </span>
<span id="cb25-17"><a href="Data-preprocessing.html#cb25-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">reduce</span>(full_join, <span class="at">by =</span><span class="st">&quot;name&quot;</span>)</span></code></pre></div>
</div>
<div id="添加分类列" class="section level4 hasAnchor" number="3.3.1.3">
<h4><span class="header-section-number">3.3.1.3</span> 添加分类列：<a href="Data-preprocessing.html#添加分类列" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="Data-preprocessing.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### # 生成快速随机代码 </span></span>
<span id="cb26-2"><a href="Data-preprocessing.html#cb26-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, <span class="dv">14</span>)  <span class="do">## 1:14 按次序生成14遍</span></span>
<span id="cb26-3"><a href="Data-preprocessing.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="Data-preprocessing.html#cb26-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">gl</span>(<span class="dv">14</span>, <span class="dv">14</span>)) <span class="do">## 这里是生成分组序列，然后再换位字符串；1到14各自14遍</span></span>
<span id="cb26-5"><a href="Data-preprocessing.html#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="Data-preprocessing.html#cb26-6" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">5</span>) <span class="co"># 0-90,5做间隔</span></span>
<span id="cb26-7"><a href="Data-preprocessing.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="Data-preprocessing.html#cb26-8" aria-hidden="true" tabindex="-1"></a> (f <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="dv">2</span>,<span class="dv">5</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;CK&quot;</span>, <span class="st">&quot;T&quot;</span>)))</span>
<span id="cb26-9"><a href="Data-preprocessing.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] CK CK CK CK CK T  T  T  T  T  </span></span></code></pre></div>
</div>
<div id="数据删除" class="section level4 hasAnchor" number="3.3.1.4">
<h4><span class="header-section-number">3.3.1.4</span> 数据删除：<a href="Data-preprocessing.html#数据删除" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="Data-preprocessing.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法1：base::transform()</span></span>
<span id="cb27-2"><a href="Data-preprocessing.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 删除某列：</span></span>
<span id="cb27-3"><a href="Data-preprocessing.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">transform</span>(BOD,<span class="at">demand=</span> <span class="cn">NULL</span> )</span>
<span id="cb27-4"><a href="Data-preprocessing.html#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="Data-preprocessing.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法2：</span></span>
<span id="cb27-6"><a href="Data-preprocessing.html#cb27-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>size      <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-7"><a href="Data-preprocessing.html#cb27-7" aria-hidden="true" tabindex="-1"></a>data[[<span class="st">&quot;size&quot;</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-8"><a href="Data-preprocessing.html#cb27-8" aria-hidden="true" tabindex="-1"></a>data[[<span class="dv">3</span>]]      <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-9"><a href="Data-preprocessing.html#cb27-9" aria-hidden="true" tabindex="-1"></a>data           <span class="ot">&lt;-</span> <span class="fu">subset</span>(data, <span class="at">select=</span><span class="sc">-</span>size)</span>
<span id="cb27-10"><a href="Data-preprocessing.html#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="Data-preprocessing.html#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="do">## tidy:</span></span>
<span id="cb27-12"><a href="Data-preprocessing.html#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rows_delete</span>(<span class="fu">tibble</span>(<span class="at">var=</span><span class="st">&quot;AAA&quot;</span>))</span></code></pre></div>
</div>
<div id="数据分列与合并" class="section level4 hasAnchor" number="3.3.1.5">
<h4><span class="header-section-number">3.3.1.5</span> 数据分列与合并<a href="Data-preprocessing.html#数据分列与合并" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="数据分列与合并-1" class="section level5 hasAnchor" number="3.3.1.5.1">
<h5><span class="header-section-number">3.3.1.5.1</span> 数据分列与合并：<a href="Data-preprocessing.html#数据分列与合并-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="Data-preprocessing.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 数据分列与合并：</span></span>
<span id="cb28-2"><a href="Data-preprocessing.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 数据分列：</span></span>
<span id="cb28-3"><a href="Data-preprocessing.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1.1 一列转多列：</span></span>
<span id="cb28-4"><a href="Data-preprocessing.html#cb28-4" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="Data-preprocessing.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(.,<span class="st">&quot;ad_date&quot;</span>,<span class="fu">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&#39;d&#39;</span>),<span class="at">sep=</span> <span class="st">&quot;-&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="Data-preprocessing.html#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="Data-preprocessing.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1.2 一列转一列，列内数据按分组及字符分割展开：</span></span>
<span id="cb28-8"><a href="Data-preprocessing.html#cb28-8" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">separate_rows</span>(.,diag,<span class="at">sep=</span><span class="st">&quot;,&quot;</span>) </span>
<span id="cb28-9"><a href="Data-preprocessing.html#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="Data-preprocessing.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1.3 列数据横向展开，独热编码：</span></span>
<span id="cb28-11"><a href="Data-preprocessing.html#cb28-11" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">separate_rows</span>(.,diag,<span class="at">sep=</span><span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-12"><a href="Data-preprocessing.html#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-13"><a href="Data-preprocessing.html#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(diag,x) <span class="sc">%&gt;%</span> </span>
<span id="cb28-14"><a href="Data-preprocessing.html#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="Data-preprocessing.html#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 数据合并：</span></span>
<span id="cb28-16"><a href="Data-preprocessing.html#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.1 对应1.1 一列转多列：合并多列到一列中：</span></span>
<span id="cb28-17"><a href="Data-preprocessing.html#cb28-17" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(n, s, b) <span class="sc">%&gt;%</span> </span>
<span id="cb28-18"><a href="Data-preprocessing.html#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(x, <span class="fu">c</span>(n, s), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-19"><a href="Data-preprocessing.html#cb28-19" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(n, s, b) <span class="sc">%&gt;%</span> </span>
<span id="cb28-20"><a href="Data-preprocessing.html#cb28-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">paste0</span>(s,b,<span class="at">collapse=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb28-21"><a href="Data-preprocessing.html#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="Data-preprocessing.html#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.2 对应1.2 一列数据按分组展开：</span></span>
<span id="cb28-23"><a href="Data-preprocessing.html#cb28-23" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb28-24"><a href="Data-preprocessing.html#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">y =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;d_e_f&quot;</span>, <span class="st">&quot;g_h&quot;</span>),</span>
<span id="cb28-25"><a href="Data-preprocessing.html#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;5&quot;</span>))</span>
<span id="cb28-26"><a href="Data-preprocessing.html#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="fu">separate_rows</span>(df,y, z,<span class="at">convert=</span><span class="cn">TRUE</span>,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-27"><a href="Data-preprocessing.html#cb28-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(x,z) <span class="sc">%&gt;%</span>  </span>
<span id="cb28-28"><a href="Data-preprocessing.html#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 注意这里不能使用mutate来构建，mutate并不会汇总数据；</span></span>
<span id="cb28-29"><a href="Data-preprocessing.html#cb28-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">y=</span> <span class="fu">str_c</span>(y,<span class="at">collapse=</span><span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="字符串分列与去重条件匹配" class="section level5 hasAnchor" number="3.3.1.5.2">
<h5><span class="header-section-number">3.3.1.5.2</span> 字符串分列与去重（条件匹配）：<a href="Data-preprocessing.html#字符串分列与去重条件匹配" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="Data-preprocessing.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 多分类数据的合并汇总实现方法：</span></span>
<span id="cb29-2"><a href="Data-preprocessing.html#cb29-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-3"><a href="Data-preprocessing.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">patient_id =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="at">each=</span><span class="dv">3</span>)),</span>
<span id="cb29-4"><a href="Data-preprocessing.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">visit_id =</span> <span class="fu">paste0</span>(<span class="st">&quot;v&quot;</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)),</span>
<span id="cb29-5"><a href="Data-preprocessing.html#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab_name =</span> <span class="fu">rep</span>(<span class="st">&quot;血肌酐&quot;</span>,<span class="dv">12</span>),</span>
<span id="cb29-6"><a href="Data-preprocessing.html#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">result_num =</span> <span class="fu">c</span>(<span class="dv">1000</span><span class="sc">:</span><span class="dv">1006</span>,<span class="dv">10</span><span class="sc">:</span><span class="dv">14</span>),</span>
<span id="cb29-7"><a href="Data-preprocessing.html#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">result_unit =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;umol/l&quot;</span>,<span class="dv">7</span>),<span class="fu">rep</span>(<span class="st">&quot;mg/dl&quot;</span>,<span class="dv">5</span>)),</span>
<span id="cb29-8"><a href="Data-preprocessing.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;male&quot;</span>,<span class="st">&quot;men&quot;</span>),<span class="at">time =</span> <span class="dv">6</span>)),</span>
<span id="cb29-9"><a href="Data-preprocessing.html#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">40</span>,<span class="at">size =</span> <span class="dv">12</span>,<span class="at">replace =</span> T)),</span>
<span id="cb29-10"><a href="Data-preprocessing.html#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span>  <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">paste</span>(<span class="st">&quot;糖尿病&quot;</span>,<span class="st">&quot;高血压&quot;</span>,<span class="st">&quot;心脏病&quot;</span>,<span class="at">sep =</span><span class="st">&quot;,&quot;</span>),<span class="at">time =</span> <span class="dv">4</span>),</span>
<span id="cb29-11"><a href="Data-preprocessing.html#cb29-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="fu">paste</span>(<span class="st">&quot;糖尿病&quot;</span>,<span class="st">&quot;心脏病&quot;</span>,<span class="at">sep =</span><span class="st">&quot;,&quot;</span>),<span class="at">time =</span> <span class="dv">4</span>),</span>
<span id="cb29-12"><a href="Data-preprocessing.html#cb29-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="fu">paste</span>(<span class="st">&quot;高血压&quot;</span>,<span class="at">sep =</span><span class="st">&quot;,&quot;</span>),<span class="at">time =</span> <span class="dv">4</span>))</span>
<span id="cb29-13"><a href="Data-preprocessing.html#cb29-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-14"><a href="Data-preprocessing.html#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="Data-preprocessing.html#cb29-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">caldiag_1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-16"><a href="Data-preprocessing.html#cb29-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;糖尿病|心脏病&quot;</span>, diag) <span class="sc">~</span> <span class="st">&quot;大病&quot;</span>,</span>
<span id="cb29-17"><a href="Data-preprocessing.html#cb29-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb29-18"><a href="Data-preprocessing.html#cb29-18" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb29-19"><a href="Data-preprocessing.html#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">caldiag_2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-20"><a href="Data-preprocessing.html#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;高血压&quot;</span>, diag) <span class="sc">~</span> <span class="st">&quot;小病&quot;</span>,</span>
<span id="cb29-21"><a href="Data-preprocessing.html#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb29-22"><a href="Data-preprocessing.html#cb29-22" aria-hidden="true" tabindex="-1"></a>  )) </span>
<span id="cb29-23"><a href="Data-preprocessing.html#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="Data-preprocessing.html#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 改进方法2：</span></span>
<span id="cb29-25"><a href="Data-preprocessing.html#cb29-25" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb29-26"><a href="Data-preprocessing.html#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(.,diag,<span class="at">sep=</span><span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-27"><a href="Data-preprocessing.html#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">caldiag =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-28"><a href="Data-preprocessing.html#cb29-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">grepl</span>(<span class="st">&quot;糖尿病|心脏病&quot;</span>, diag) <span class="sc">~</span> <span class="st">&quot;大病&quot;</span>,</span>
<span id="cb29-29"><a href="Data-preprocessing.html#cb29-29" aria-hidden="true" tabindex="-1"></a>          diag <span class="sc">==</span> <span class="st">&quot;高血压&quot;</span> <span class="sc">~</span> <span class="st">&quot;小病&quot;</span>,</span>
<span id="cb29-30"><a href="Data-preprocessing.html#cb29-30" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;缺失&quot;</span></span>
<span id="cb29-31"><a href="Data-preprocessing.html#cb29-31" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span>diag) <span class="sc">%&gt;%</span> </span>
<span id="cb29-32"><a href="Data-preprocessing.html#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(visit_id) <span class="sc">%&gt;%</span> </span>
<span id="cb29-33"><a href="Data-preprocessing.html#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">y=</span> <span class="fu">str_c</span>(<span class="fu">unique</span>(caldiag),<span class="at">collapse=</span><span class="st">&quot;,&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-34"><a href="Data-preprocessing.html#cb29-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(data,<span class="at">by=</span><span class="st">&quot;visit_id&quot;</span>)  <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb29-35"><a href="Data-preprocessing.html#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="Data-preprocessing.html#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 改进方法3：</span></span>
<span id="cb29-37"><a href="Data-preprocessing.html#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符串去重：只适合全部变量均可匹配：</span></span>
<span id="cb29-38"><a href="Data-preprocessing.html#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 这种方法不好的原因在于全局匹配，置换后的数据行还会包含未被分类的数据集：</span></span>
<span id="cb29-39"><a href="Data-preprocessing.html#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 类似这样：&quot;大病,终末期肾脏疾病&quot;  </span></span>
<span id="cb29-40"><a href="Data-preprocessing.html#cb29-40" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb29-41"><a href="Data-preprocessing.html#cb29-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-42"><a href="Data-preprocessing.html#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">cla =</span> <span class="fu">str_replace_all</span>(.<span class="sc">$</span>diag,<span class="fu">c</span>(<span class="st">&quot;糖尿病|心脏病&quot;</span> <span class="ot">=</span> <span class="st">&quot;大病&quot;</span>, <span class="st">&quot;高血压&quot;</span> <span class="ot">=</span> <span class="st">&quot;小病&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-43"><a href="Data-preprocessing.html#cb29-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map</span>(., <span class="cf">function</span>(x) <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(<span class="fu">str_split</span>(x,<span class="st">&quot;,&quot;</span>))), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-44"><a href="Data-preprocessing.html#cb29-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>() )</span></code></pre></div>
</div>
<div id="批量重命名列名" class="section level5 hasAnchor" number="3.3.1.5.3">
<h5><span class="header-section-number">3.3.1.5.3</span> 批量重命名（列名）<a href="Data-preprocessing.html#批量重命名列名" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<pre><code>## 单个变量重命名：
iris %&gt;% rename(&quot;1&quot; = &quot;Sepal.Length&quot;,&quot;2&quot; =&quot;Sepal.Width&quot; ) %&gt;% names()

## 批量构造虚拟数据集进行填充后重新批量命名：
out1_df =  matrix(&quot;NA&quot;,ncol = length(out1),nrow =  dim(lab_fp)[1]) %&gt;% data.frame() %&gt;% rename_at(vars(names(.)) ,~ out1)    

## 数据列重命名：
rename(flights,YEAR=year)

## 构造列名：
setNames( 1:3, c(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;) )
# this is just a short form of
tmp &lt;- 1:3
names(tmp) &lt;-  c(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;)</code></pre>
</div>
</div>
</div>
<div id="数据值重编码非列名" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> 数据值重编码（非列名）<a href="Data-preprocessing.html#数据值重编码非列名" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="二分类重编码" class="section level4 hasAnchor" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> 二分类重编码<a href="Data-preprocessing.html#二分类重编码" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="Data-preprocessing.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法1，构建函数：</span></span>
<span id="cb31-2"><a href="Data-preprocessing.html#cb31-2" aria-hidden="true" tabindex="-1"></a>f3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb31-3"><a href="Data-preprocessing.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="Data-preprocessing.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法2：使用plyr包中的revalue() 或 mapvalues()</span></span>
<span id="cb31-5"><a href="Data-preprocessing.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb31-6"><a href="Data-preprocessing.html#cb31-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>scode <span class="ot">&lt;-</span> <span class="fu">revalue</span>(data<span class="sc">$</span>sex, <span class="fu">c</span>(<span class="at">M =</span> <span class="st">&quot;1&quot;</span>, <span class="at">F =</span> <span class="st">&quot;2&quot;</span>))</span>
<span id="cb31-7"><a href="Data-preprocessing.html#cb31-7" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>scode <span class="ot">&lt;-</span> <span class="fu">mapvalues</span>(data<span class="sc">$</span>sex, <span class="at">from =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, </span>
<span id="cb31-8"><a href="Data-preprocessing.html#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;2&quot;</span>))</span>
<span id="cb31-9"><a href="Data-preprocessing.html#cb31-9" aria-hidden="true" tabindex="-1"></a>str <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb31-10"><a href="Data-preprocessing.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mapvalues</span>(str, <span class="at">from =</span> <span class="fu">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>), <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;two&quot;</span>,  <span class="st">&quot;three&quot;</span>))</span>
<span id="cb31-11"><a href="Data-preprocessing.html#cb31-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-12"><a href="Data-preprocessing.html#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法3：base-R直接赋值：</span></span>
<span id="cb31-13"><a href="Data-preprocessing.html#cb31-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>scode[data<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;M&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;1&quot;</span></span>
<span id="cb31-14"><a href="Data-preprocessing.html#cb31-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>category[data<span class="sc">$</span>control <span class="sc">&lt;</span> <span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="st">&quot;low&quot;</span></span>
<span id="cb31-15"><a href="Data-preprocessing.html#cb31-15" aria-hidden="true" tabindex="-1"></a>str[str <span class="sc">==</span> <span class="st">&quot;beta&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;two&quot;</span></span>
<span id="cb31-16"><a href="Data-preprocessing.html#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="Data-preprocessing.html#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法4： 使用正则来进行选择匹配：</span></span>
<span id="cb31-18"><a href="Data-preprocessing.html#cb31-18" aria-hidden="true" tabindex="-1"></a>str <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb31-19"><a href="Data-preprocessing.html#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span>(<span class="st">&quot;^alpha$&quot;</span>, <span class="st">&quot;one&quot;</span>, str)</span>
<span id="cb31-20"><a href="Data-preprocessing.html#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 把所有列的 &#39;a&#39; 替代为 &#39;X&#39;</span></span>
<span id="cb31-21"><a href="Data-preprocessing.html#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;X&quot;</span>, str)</span>
<span id="cb31-22"><a href="Data-preprocessing.html#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;XlphX&quot; &quot;betX&quot;  &quot;gXmmX&quot;</span></span>
<span id="cb31-23"><a href="Data-preprocessing.html#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="Data-preprocessing.html#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法5使用if-else()</span></span>
<span id="cb31-25"><a href="Data-preprocessing.html#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 注意这种mutate指定的方法比赋值参数更好用；</span></span>
<span id="cb31-26"><a href="Data-preprocessing.html#cb31-26" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-27"><a href="Data-preprocessing.html#cb31-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">status=</span> <span class="fu">if_else</span>(.<span class="sc">$</span>points <span class="sc">&gt;</span> <span class="dv">20</span>, <span class="st">&#39;Good&#39;</span>, <span class="st">&#39;Bad&#39;</span>))</span></code></pre></div>
</div>
<div id="多分类重编码" class="section level4 hasAnchor" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> 多分类重编码<a href="Data-preprocessing.html#多分类重编码" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="Data-preprocessing.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法1：使用age_categories()进行数据的多分类(连续变量)           </span></span>
<span id="cb32-2"><a href="Data-preprocessing.html#cb32-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="Data-preprocessing.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_cat =</span> <span class="fu">cut</span>(</span>
<span id="cb32-4"><a href="Data-preprocessing.html#cb32-4" aria-hidden="true" tabindex="-1"></a>    age_years,</span>
<span id="cb32-5"><a href="Data-preprocessing.html#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),          </span>
<span id="cb32-6"><a href="Data-preprocessing.html#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-7"><a href="Data-preprocessing.html#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,        </span>
<span id="cb32-8"><a href="Data-preprocessing.html#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>)),</span>
<span id="cb32-9"><a href="Data-preprocessing.html#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">fct_explicit_na</span>(</span>
<span id="cb32-10"><a href="Data-preprocessing.html#cb32-10" aria-hidden="true" tabindex="-1"></a>      age_cat,</span>
<span id="cb32-11"><a href="Data-preprocessing.html#cb32-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">na_level =</span> <span class="st">&quot;Missing age&quot;</span>))    </span>
<span id="cb32-12"><a href="Data-preprocessing.html#cb32-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb32-13"><a href="Data-preprocessing.html#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法2：使用cut函数进行数据多分组分类：</span></span>
<span id="cb32-14"><a href="Data-preprocessing.html#cb32-14" aria-hidden="true" tabindex="-1"></a>age <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">15</span>,<span class="dv">36</span>,<span class="dv">47</span>,<span class="dv">65</span>,<span class="dv">53</span>)</span>
<span id="cb32-15"><a href="Data-preprocessing.html#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span>(age,<span class="at">breaks =</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">18</span>,<span class="dv">45</span>,<span class="dv">100</span>),<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;o&quot;</span>))</span>
<span id="cb32-16"><a href="Data-preprocessing.html#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="Data-preprocessing.html#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="Data-preprocessing.html#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="do">### 方法3使用dplyr::ntile()来实现数据的均等分类：</span></span>
<span id="cb32-19"><a href="Data-preprocessing.html#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># make groups with ntile()</span></span>
<span id="cb32-20"><a href="Data-preprocessing.html#cb32-20" aria-hidden="true" tabindex="-1"></a>ntile_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb32-21"><a href="Data-preprocessing.html#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">even_groups =</span> <span class="fu">ntile</span>(age_years, <span class="dv">10</span>))</span>
<span id="cb32-22"><a href="Data-preprocessing.html#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="Data-preprocessing.html#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="do">### 方法4：使用sjmisc::rec()函数来匹配数据后，生成对应编码新值；</span></span>
<span id="cb32-24"><a href="Data-preprocessing.html#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjmisc)</span>
<span id="cb32-25"><a href="Data-preprocessing.html#cb32-25" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">rec</span>(math,<span class="at">rec =</span><span class="st">&quot;min:59= 不及格&quot;</span>；<span class="dv">60</span><span class="sc">:</span><span class="dv">74</span> <span class="ot">=</span>中；<span class="dv">75</span><span class="sc">:</span><span class="dv">85</span><span class="ot">=</span> 良；85：<span class="at">max=</span> <span class="st">&quot;优&quot;</span>，   <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-26"><a href="Data-preprocessing.html#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="Data-preprocessing.html#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  方法5：case_when()：多条件编码；</span></span>
<span id="cb32-28"><a href="Data-preprocessing.html#cb32-28" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">if_else</span>(<span class="at">sex =</span><span class="st">&quot;男&quot;</span>,<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>)) <span class="co"># 等于男则为M，否则为F；</span></span>
<span id="cb32-29"><a href="Data-preprocessing.html#cb32-29" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">math =</span><span class="fu">case_when</span>(math <span class="sc">&gt;=</span> <span class="dv">75</span><span class="sc">~</span><span class="st">&quot;high&quot;</span>,</span>
<span id="cb32-30"><a href="Data-preprocessing.html#cb32-30" aria-hidden="true" tabindex="-1"></a>                            math <span class="sc">&gt;=</span> <span class="dv">60</span><span class="sc">~</span><span class="st">&quot;middle&quot;</span>,</span>
<span id="cb32-31"><a href="Data-preprocessing.html#cb32-31" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;LOW&quot;</span>))  <span class="do">## 最后一个TRUE表示所有剩余分支； </span></span>
<span id="cb32-32"><a href="Data-preprocessing.html#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="Data-preprocessing.html#cb32-33" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div id="批量分类case_whenfcase" class="section level4 hasAnchor" number="3.3.2.3">
<h4><span class="header-section-number">3.3.2.3</span> 批量分类case_when/fcase：<a href="Data-preprocessing.html#批量分类case_whenfcase" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="Data-preprocessing.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 批量分类方法1：</span></span>
<span id="cb33-2"><a href="Data-preprocessing.html#cb33-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>  </span>
<span id="cb33-3"><a href="Data-preprocessing.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(           <span class="do">## 下面这个all_of()的用法很棒！               </span></span>
<span id="cb33-4"><a href="Data-preprocessing.html#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">c</span>(explanatory_vars, <span class="st">&quot;outcome&quot;</span>)), </span>
<span id="cb33-5"><a href="Data-preprocessing.html#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">case_when</span>(                              </span>
<span id="cb33-6"><a href="Data-preprocessing.html#cb33-6" aria-hidden="true" tabindex="-1"></a>      . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;Death&quot;</span>)   <span class="sc">~</span> <span class="dv">1</span>,  <span class="do">## 将其分类转为1和0；         </span></span>
<span id="cb33-7"><a href="Data-preprocessing.html#cb33-7" aria-hidden="true" tabindex="-1"></a>      . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;no&quot;</span>,  <span class="st">&quot;Recover&quot;</span>) <span class="sc">~</span> <span class="dv">0</span>,          </span>
<span id="cb33-8"><a href="Data-preprocessing.html#cb33-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                            <span class="sc">~</span> <span class="cn">NA_real_</span>)  </span>
<span id="cb33-9"><a href="Data-preprocessing.html#cb33-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-10"><a href="Data-preprocessing.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-11"><a href="Data-preprocessing.html#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="Data-preprocessing.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="do">## case_when是一种极其占有内存和浪费时间的方法：</span></span>
<span id="cb33-13"><a href="Data-preprocessing.html#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 优先使用data.table()中的fcase来实现条件替换,效率提高10倍：</span></span>
<span id="cb33-14"><a href="Data-preprocessing.html#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 与case_when()体系不同的是：</span></span>
<span id="cb33-15"><a href="Data-preprocessing.html#cb33-15" aria-hidden="true" tabindex="-1"></a>同义替换间使用逗号，而不是<span class="sc">~</span>；</span>
<span id="cb33-16"><a href="Data-preprocessing.html#cb33-16" aria-hidden="true" tabindex="-1"></a>最后的默认参数，使用default，而不是TRUE;</span>
<span id="cb33-17"><a href="Data-preprocessing.html#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="Data-preprocessing.html#cb33-18" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>  </span>
<span id="cb33-19"><a href="Data-preprocessing.html#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(           <span class="do">## 下面这个all_of()的用法很棒！               </span></span>
<span id="cb33-20"><a href="Data-preprocessing.html#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">c</span>(explanatory_vars, <span class="st">&quot;outcome&quot;</span>)), </span>
<span id="cb33-21"><a href="Data-preprocessing.html#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">fcase</span>(                              </span>
<span id="cb33-22"><a href="Data-preprocessing.html#cb33-22" aria-hidden="true" tabindex="-1"></a>      . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;Death&quot;</span>)   ,<span class="dv">1</span>,  <span class="do">## 将其分类转为1和0；      </span></span>
<span id="cb33-23"><a href="Data-preprocessing.html#cb33-23" aria-hidden="true" tabindex="-1"></a>      . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;no&quot;</span>,  <span class="st">&quot;Recover&quot;</span>) , <span class="dv">0</span>,   </span>
<span id="cb33-24"><a href="Data-preprocessing.html#cb33-24" aria-hidden="true" tabindex="-1"></a>        <span class="do">## 注意：default必须是一个固定的参数值，不能像case_when那样实现非过滤等价；</span></span>
<span id="cb33-25"><a href="Data-preprocessing.html#cb33-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">default =</span>  <span class="cn">NA_real_</span>)  </span>
<span id="cb33-26"><a href="Data-preprocessing.html#cb33-26" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb33-27"><a href="Data-preprocessing.html#cb33-27" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div id="数据类型重编码" class="section level4 hasAnchor" number="3.3.2.4">
<h4><span class="header-section-number">3.3.2.4</span> 数据类型重编码<a href="Data-preprocessing.html#数据类型重编码" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="Data-preprocessing.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform函数</span></span>
<span id="cb34-2"><a href="Data-preprocessing.html#cb34-2" aria-hidden="true" tabindex="-1"></a> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="Data-preprocessing.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">cyl =</span> <span class="fu">factor</span>(cyl),</span>
<span id="cb34-4"><a href="Data-preprocessing.html#cb34-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">hp =</span> <span class="fu">factor</span>(hp)) <span class="sc">%&gt;%</span>  <span class="fu">as_tibble</span>()</span>
<span id="cb34-5"><a href="Data-preprocessing.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 指定数据形式的转换：</span></span>
<span id="cb34-6"><a href="Data-preprocessing.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">transform</span>(BOD,<span class="fu">as.numeric</span>(Time))</span>
<span id="cb34-7"><a href="Data-preprocessing.html#cb34-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-8"><a href="Data-preprocessing.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># mutate函数</span></span>
<span id="cb34-9"><a href="Data-preprocessing.html#cb34-9" aria-hidden="true" tabindex="-1"></a>dta <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="Data-preprocessing.html#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cyl =</span> <span class="fu">factor</span>(cyl),  <span class="at">hp =</span> <span class="fu">factor</span>(hp)) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="Data-preprocessing.html#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb34-12"><a href="Data-preprocessing.html#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="Data-preprocessing.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 较多变量：使用.cross()</span></span>
<span id="cb34-14"><a href="Data-preprocessing.html#cb34-14" aria-hidden="true" tabindex="-1"></a>dta <span class="sc">%&gt;%</span></span>
<span id="cb34-15"><a href="Data-preprocessing.html#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.integer), factor)) <span class="sc">%&gt;%</span>  <span class="fu">is.interger</span>()  <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()    <span class="co"># 判断数字为整形；</span></span>
<span id="cb34-16"><a href="Data-preprocessing.html#cb34-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-17"><a href="Data-preprocessing.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 但在实际项目中R的行列参数类型往往为double()类型，因此单纯使用上面两种类型，往往找不到对应的类型变量；</span></span>
<span id="cb34-18"><a href="Data-preprocessing.html#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 因此可以使用整除的方法进行筛选变量：</span></span>
<span id="cb34-19"><a href="Data-preprocessing.html#cb34-19" aria-hidden="true" tabindex="-1"></a>dta <span class="sc">%&gt;%</span></span>
<span id="cb34-20"><a href="Data-preprocessing.html#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="cf">function</span>(col) <span class="fu">all</span>(col <span class="sc">%%</span> <span class="dv">1</span><span class="sc">==</span><span class="dv">0</span>), factor)) <span class="sc">%&gt;%</span>  <span class="fu">as_tibble</span>()  <span class="do">## 即整数除以1后的余数为0</span></span>
<span id="cb34-21"><a href="Data-preprocessing.html#cb34-21" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-22"><a href="Data-preprocessing.html#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 补充一种时间序列的处理方法：</span></span>
<span id="cb34-23"><a href="Data-preprocessing.html#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.POSIXct), <span class="at">.fns =</span> as.Date))</span>
<span id="cb34-24"><a href="Data-preprocessing.html#cb34-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-25"><a href="Data-preprocessing.html#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 自定义高效函数重新编码：                </span></span>
<span id="cb34-26"><a href="Data-preprocessing.html#cb34-26" aria-hidden="true" tabindex="-1"></a>tr2 <span class="ot">=</span> <span class="cf">function</span>(data,aim_col,funss){</span>
<span id="cb34-27"><a href="Data-preprocessing.html#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 将变量解析为字符串：</span></span>
<span id="cb34-28"><a href="Data-preprocessing.html#cb34-28" aria-hidden="true" tabindex="-1"></a>  aim_cha <span class="ot">=</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(funss))</span>
<span id="cb34-29"><a href="Data-preprocessing.html#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 使用bangbang来运行解析式：</span></span>
<span id="cb34-30"><a href="Data-preprocessing.html#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!!</span>aim_cha <span class="sc">==</span> <span class="st">&quot;num&quot;</span>){</span>
<span id="cb34-31"><a href="Data-preprocessing.html#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 使用{{}}来纳入变量参数：</span></span>
<span id="cb34-32"><a href="Data-preprocessing.html#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb34-33"><a href="Data-preprocessing.html#cb34-33" aria-hidden="true" tabindex="-1"></a>      data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> {{aim_col}}, <span class="at">.fns =</span> as.numeric)))</span>
<span id="cb34-34"><a href="Data-preprocessing.html#cb34-34" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!!</span>aim_cha <span class="sc">==</span> <span class="st">&quot;dat&quot;</span>){</span>
<span id="cb34-35"><a href="Data-preprocessing.html#cb34-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb34-36"><a href="Data-preprocessing.html#cb34-36" aria-hidden="true" tabindex="-1"></a>      data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> {{aim_col}}, <span class="at">.fns =</span> as_date)))</span>
<span id="cb34-37"><a href="Data-preprocessing.html#cb34-37" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!!</span>aim_cha <span class="sc">==</span> <span class="st">&quot;cha&quot;</span>){</span>
<span id="cb34-38"><a href="Data-preprocessing.html#cb34-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb34-39"><a href="Data-preprocessing.html#cb34-39" aria-hidden="true" tabindex="-1"></a>      data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> {{aim_col}}, <span class="at">.fns =</span> as.character)))</span>
<span id="cb34-40"><a href="Data-preprocessing.html#cb34-40" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!!</span>aim_cha <span class="sc">==</span> <span class="st">&quot;fac&quot;</span>){</span>
<span id="cb34-41"><a href="Data-preprocessing.html#cb34-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb34-42"><a href="Data-preprocessing.html#cb34-42" aria-hidden="true" tabindex="-1"></a>      data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> {{aim_col}}, <span class="at">.fns =</span> as.factor))) </span>
<span id="cb34-43"><a href="Data-preprocessing.html#cb34-43" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="st">&quot;input function fasle&quot;</span>}}</span>
<span id="cb34-44"><a href="Data-preprocessing.html#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="Data-preprocessing.html#cb34-45" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">tr2</span>(.,Species,fac)</span>
<span id="cb34-46"><a href="Data-preprocessing.html#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="do">## 对于多参数模型，还不能很好的纳入across中.col这种方法；</span></span>
<span id="cb34-47"><a href="Data-preprocessing.html#cb34-47" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">tr</span>(.,<span class="fu">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>,<span class="st">&quot;Sepal.Width&quot;</span>),num)            </span></code></pre></div>
</div>
<div id="因子编码调整" class="section level4 hasAnchor" number="3.3.2.5">
<h4><span class="header-section-number">3.3.2.5</span> 因子编码调整<a href="Data-preprocessing.html#因子编码调整" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="基于forcats包的分类" class="section level5 hasAnchor" number="3.3.2.5.1">
<h5><span class="header-section-number">3.3.2.5.1</span> 基于forcats包的分类<a href="Data-preprocessing.html#基于forcats包的分类" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="Data-preprocessing.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base R</span></span>
<span id="cb35-2"><a href="Data-preprocessing.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">pbg_cat =</span> <span class="fu">factor</span>(</span>
<span id="cb35-3"><a href="Data-preprocessing.html#cb35-3" aria-hidden="true" tabindex="-1"></a>    pbg_cat,</span>
<span id="cb35-4"><a href="Data-preprocessing.html#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;[0, 7.8)&quot;</span>, <span class="st">&quot;[7.8, 10.0)&quot;</span>, <span class="st">&quot;[10.0, 11.1)&quot;</span>, </span>
<span id="cb35-5"><a href="Data-preprocessing.html#cb35-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;[11.1, 12.0)&quot;</span>, <span class="st">&quot;[12.0, +)&quot;</span>)))</span>
<span id="cb35-6"><a href="Data-preprocessing.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 调整分组排序：</span></span>
<span id="cb35-7"><a href="Data-preprocessing.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_relevel</span>(delay_cat, <span class="st">&quot;&lt;2 days&quot;</span>, <span class="st">&quot;2-5 days&quot;</span>, <span class="st">&quot;&gt;5 days&quot;</span>))</span>
<span id="cb35-8"><a href="Data-preprocessing.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加额外分组标化：</span></span>
<span id="cb35-9"><a href="Data-preprocessing.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_expand</span>(delay_cat, <span class="st">&quot;Not admitted to hospital&quot;</span>, <span class="st">&quot;Transfer to other jurisdiction&quot;</span>))</span>
<span id="cb35-10"><a href="Data-preprocessing.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除分组：</span></span>
<span id="cb35-11"><a href="Data-preprocessing.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_drop</span>(delay_cat))  <span class="do">##</span></span>
<span id="cb35-12"><a href="Data-preprocessing.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 分组重编码：</span></span>
<span id="cb35-13"><a href="Data-preprocessing.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">delay_cat =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb35-14"><a href="Data-preprocessing.html#cb35-14" aria-hidden="true" tabindex="-1"></a>    delay_cat,</span>
<span id="cb35-15"><a href="Data-preprocessing.html#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Less than 2 days&quot;</span> <span class="ot">=</span> <span class="st">&quot;&lt;2 days&quot;</span>,</span>
<span id="cb35-16"><a href="Data-preprocessing.html#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2 to 5 days&quot;</span>      <span class="ot">=</span> <span class="st">&quot;2-5 days&quot;</span>,</span>
<span id="cb35-17"><a href="Data-preprocessing.html#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;More than 5 days&quot;</span> <span class="ot">=</span> <span class="st">&quot;&gt;5 days&quot;</span>))</span>
<span id="cb35-18"><a href="Data-preprocessing.html#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="Data-preprocessing.html#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="do">## fct_recode重编码的另外一种形式：</span></span>
<span id="cb35-20"><a href="Data-preprocessing.html#cb35-20" aria-hidden="true" tabindex="-1"></a>meldata <span class="ot">&lt;-</span> meldata <span class="sc">%&gt;%</span> </span>
<span id="cb35-21"><a href="Data-preprocessing.html#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex.factor =</span>             <span class="co"># Make new variable  </span></span>
<span id="cb35-22"><a href="Data-preprocessing.html#cb35-22" aria-hidden="true" tabindex="-1"></a>           sex <span class="sc">%&gt;%</span>                <span class="co"># from existing variable</span></span>
<span id="cb35-23"><a href="Data-preprocessing.html#cb35-23" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>() <span class="sc">%&gt;%</span>           <span class="co"># convert to factor</span></span>
<span id="cb35-24"><a href="Data-preprocessing.html#cb35-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_recode</span>(            <span class="co"># forcats function</span></span>
<span id="cb35-25"><a href="Data-preprocessing.html#cb35-25" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Female&quot;</span> <span class="ot">=</span> <span class="st">&quot;0&quot;</span>,      <span class="co"># new on left, old on right</span></span>
<span id="cb35-26"><a href="Data-preprocessing.html#cb35-26" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Male&quot;</span>   <span class="ot">=</span> <span class="st">&quot;1&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-27"><a href="Data-preprocessing.html#cb35-27" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ff_label</span>(<span class="st">&quot;Sex&quot;</span>),       <span class="co"># Optional label for finalfit</span></span>
<span id="cb35-28"><a href="Data-preprocessing.html#cb35-28" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb35-29"><a href="Data-preprocessing.html#cb35-29" aria-hidden="true" tabindex="-1"></a>         <span class="co"># same thing but more condensed code:</span></span>
<span id="cb35-30"><a href="Data-preprocessing.html#cb35-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">ulcer.factor =</span> <span class="fu">factor</span>(ulcer) <span class="sc">%&gt;%</span> </span>
<span id="cb35-31"><a href="Data-preprocessing.html#cb35-31" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_recode</span>(<span class="st">&quot;Present&quot;</span> <span class="ot">=</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb35-32"><a href="Data-preprocessing.html#cb35-32" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Absent&quot;</span>  <span class="ot">=</span> <span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-33"><a href="Data-preprocessing.html#cb35-33" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ff_label</span>(<span class="st">&quot;Ulcerated tumour&quot;</span>),</span>
<span id="cb35-34"><a href="Data-preprocessing.html#cb35-34" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb35-35"><a href="Data-preprocessing.html#cb35-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">status.factor =</span> <span class="fu">factor</span>(status) <span class="sc">%&gt;%</span> </span>
<span id="cb35-36"><a href="Data-preprocessing.html#cb35-36" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_recode</span>(<span class="st">&quot;Died melanoma&quot;</span>       <span class="ot">=</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb35-37"><a href="Data-preprocessing.html#cb35-37" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Alive&quot;</span>               <span class="ot">=</span> <span class="st">&quot;2&quot;</span>,</span>
<span id="cb35-38"><a href="Data-preprocessing.html#cb35-38" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Died - other causes&quot;</span> <span class="ot">=</span> <span class="st">&quot;3&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-39"><a href="Data-preprocessing.html#cb35-39" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ff_label</span>(<span class="st">&quot;Status&quot;</span>))</span>
<span id="cb35-40"><a href="Data-preprocessing.html#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="Data-preprocessing.html#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="Data-preprocessing.html#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="do">## 合并分组后重编码：</span></span>
<span id="cb35-43"><a href="Data-preprocessing.html#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 新生成变量命名为new，列内将原来Species中的setosa和virginica修改命名为newss；暂时不知道其底层逻辑是多少，但可能是一种便捷的处理方法：</span></span>
<span id="cb35-44"><a href="Data-preprocessing.html#cb35-44" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">new =</span> </span>
<span id="cb35-45"><a href="Data-preprocessing.html#cb35-45" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">fct_collapse</span>(Species,</span>
<span id="cb35-46"><a href="Data-preprocessing.html#cb35-46" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newss =</span> <span class="fu">c</span>(<span class="st">&quot;setosa&quot;</span>,<span class="st">&quot;virginica&quot;</span>)) ) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span></code></pre></div>
</div>
<div id="批量标签分类调整" class="section level5 hasAnchor" number="3.3.2.5.2">
<h5><span class="header-section-number">3.3.2.5.2</span> 批量标签分类调整：<a href="Data-preprocessing.html#批量标签分类调整" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="Data-preprocessing.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 批量分类方法2：</span></span>
<span id="cb36-2"><a href="Data-preprocessing.html#cb36-2" aria-hidden="true" tabindex="-1"></a>expss<span class="sc">::</span><span class="fu">apply_labels</span>(<span class="at">fbg_diff =</span> <span class="st">&quot;空腹血糖变化差值&quot;</span>,</span>
<span id="cb36-3"><a href="Data-preprocessing.html#cb36-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">fbg_reg =</span> <span class="st">&quot;末次空腹血糖&lt;6.1m/mol&quot;</span>,</span>
<span id="cb36-4"><a href="Data-preprocessing.html#cb36-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">age =</span> <span class="st">&quot;年龄&quot;</span>,</span>
<span id="cb36-5"><a href="Data-preprocessing.html#cb36-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">sex =</span> <span class="st">&quot;性别&quot;</span> )</span>
<span id="cb36-6"><a href="Data-preprocessing.html#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="Data-preprocessing.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 批量分类方法3：</span></span>
<span id="cb36-8"><a href="Data-preprocessing.html#cb36-8" aria-hidden="true" tabindex="-1"></a>visit_clean <span class="ot">&lt;-</span> visit <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="Data-preprocessing.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">insurance_type =</span> <span class="fu">recode</span>(insurance_type,</span>
<span id="cb36-10"><a href="Data-preprocessing.html#cb36-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">is.na =</span> <span class="st">&quot;医保类型缺失&quot;</span>)) </span>
<span id="cb36-11"><a href="Data-preprocessing.html#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="Data-preprocessing.html#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 批量修改重分类方法4：</span></span>
<span id="cb36-13"><a href="Data-preprocessing.html#cb36-13" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>group <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">mapvalues</span>(tmp<span class="sc">$</span>group, <span class="at">from =</span> <span class="fu">c</span>(<span class="st">&quot;GFP- early&quot;</span>,<span class="st">&quot;GFP+ early&quot;</span>,<span class="st">&quot;GFP- late&quot;</span>,<span class="st">&quot;GFP+ late&quot;</span>),</span>
<span id="cb36-14"><a href="Data-preprocessing.html#cb36-14" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;HhOFF early&quot;</span>, <span class="st">&quot;HhON early&quot;</span>, <span class="st">&quot;HhOFF late&quot;</span>, <span class="st">&quot;HhON late&quot;</span>))</span>
<span id="cb36-15"><a href="Data-preprocessing.html#cb36-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-16"><a href="Data-preprocessing.html#cb36-16" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp<span class="sc">$</span>group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;HhOFF early&quot;</span>, <span class="st">&quot;HhON early&quot;</span>, <span class="st">&quot;HhOFF late&quot;</span>, <span class="st">&quot;HhON late&quot;</span>))</span></code></pre></div>
</div>
<div id="高效标签编码datapasta" class="section level5 hasAnchor" number="3.3.2.5.3">
<h5><span class="header-section-number">3.3.2.5.3</span> 高效标签编码<code>datapasta</code><a href="Data-preprocessing.html#高效标签编码datapasta" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="Data-preprocessing.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## datapasta 提供了一种范式，可以将变量名按照固定格式输出到代码块中，方便粘贴使用：</span></span>
<span id="cb37-2"><a href="Data-preprocessing.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;datapasta&quot;</span>)</span>
<span id="cb37-3"><a href="Data-preprocessing.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datapasta )</span>
<span id="cb37-4"><a href="Data-preprocessing.html#cb37-4" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="Data-preprocessing.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="Data-preprocessing.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb37-7"><a href="Data-preprocessing.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="Data-preprocessing.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  datapasta<span class="sc">::</span><span class="fu">vector_paste_vertical</span>()</span>
<span id="cb37-9"><a href="Data-preprocessing.html#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="Data-preprocessing.html#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 纵向输出，同时将代码结果掩盖：</span></span>
<span id="cb37-11"><a href="Data-preprocessing.html#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;setosa&quot;</span>,</span>
<span id="cb37-12"><a href="Data-preprocessing.html#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;versicolor&quot;</span>,</span>
<span id="cb37-13"><a href="Data-preprocessing.html#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;virginica&quot;</span>)</span>
<span id="cb37-14"><a href="Data-preprocessing.html#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="Data-preprocessing.html#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 横向输出，同时将代码结果掩盖：</span></span>
<span id="cb37-16"><a href="Data-preprocessing.html#cb37-16" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb37-17"><a href="Data-preprocessing.html#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb37-18"><a href="Data-preprocessing.html#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb37-19"><a href="Data-preprocessing.html#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-20"><a href="Data-preprocessing.html#cb37-20" aria-hidden="true" tabindex="-1"></a>  datapasta<span class="sc">::</span><span class="fu">vector_paste</span>()</span>
<span id="cb37-21"><a href="Data-preprocessing.html#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolor&quot;</span>, <span class="st">&quot;virginica&quot;</span>)</span>
<span id="cb37-22"><a href="Data-preprocessing.html#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="Data-preprocessing.html#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 借助上面的函数实现高效的case_when之类的数据替换：</span></span>
<span id="cb37-24"><a href="Data-preprocessing.html#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 数据替换后：可以借助Rstudi0的快捷键使用批量多项选择：</span></span>
<span id="cb37-25"><a href="Data-preprocessing.html#cb37-25" aria-hidden="true" tabindex="-1"></a>Mac 上的 Opt 键 <span class="sc">+</span> 鼠标左键拖动</span>
<span id="cb37-26"><a href="Data-preprocessing.html#cb37-26" aria-hidden="true" tabindex="-1"></a>Windows 上的 Alt 键 <span class="sc">+</span> 鼠标左键拖动</span>
<span id="cb37-27"><a href="Data-preprocessing.html#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 这个过程简单来说，就是按住alt+左键之后，批量选择纵向输出列，然后对这些列进行批量代码替换和处理。</span></span></code></pre></div>
</div>
</div>
<div id="构造哑变量" class="section level4 hasAnchor" number="3.3.2.6">
<h4><span class="header-section-number">3.3.2.6</span> 构造哑变量<a href="Data-preprocessing.html#构造哑变量" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="Data-preprocessing.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb38-2"><a href="Data-preprocessing.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb38-3"><a href="Data-preprocessing.html#cb38-3" aria-hidden="true" tabindex="-1"></a>dummies <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="sc">~</span>League<span class="sc">+</span>Division<span class="sc">+</span>NewLeague, <span class="at">data =</span> Hitters)</span>
<span id="cb38-4"><a href="Data-preprocessing.html#cb38-4" aria-hidden="true" tabindex="-1"></a>dummies <span class="ot">&lt;-</span> <span class="fu">predict</span>(dummies, <span class="at">newdata =</span> Hitters)</span>
<span id="cb38-5"><a href="Data-preprocessing.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dummies)</span></code></pre></div>
</div>
</div>
<div id="数据塑形" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> 数据塑形<a href="Data-preprocessing.html#数据塑形" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="数据排序" class="section level4 hasAnchor" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> 数据排序<a href="Data-preprocessing.html#数据排序" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="Data-preprocessing.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># 第一列升序，然后是第三列降序</span></span>
<span id="cb39-2"><a href="Data-preprocessing.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> r2 <span class="ot">=</span> iris[<span class="fu">order</span>(iris[,<span class="dv">1</span>],<span class="sc">-</span>iris[<span class="dv">3</span>]),]</span>
<span id="cb39-3"><a href="Data-preprocessing.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># 第一列升序，然后是第三列升序序</span></span>
<span id="cb39-4"><a href="Data-preprocessing.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> r2 <span class="ot">=</span> iris[<span class="fu">order</span>(iris[,<span class="dv">1</span>],iris[<span class="dv">3</span>]),]</span>
<span id="cb39-5"><a href="Data-preprocessing.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 或者使用dplyr::arrange()</span></span>
<span id="cb39-6"><a href="Data-preprocessing.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-7"><a href="Data-preprocessing.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;iris&quot;</span>)</span>
<span id="cb39-8"><a href="Data-preprocessing.html#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb39-9"><a href="Data-preprocessing.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 第一列升序，然后是第三列升序</span></span>
<span id="cb39-10"><a href="Data-preprocessing.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(iris,iris[,<span class="dv">1</span>],iris[,<span class="dv">3</span>])</span>
<span id="cb39-11"><a href="Data-preprocessing.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 第一列升序，然后是第三列降序</span></span>
<span id="cb39-12"><a href="Data-preprocessing.html#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(iris,iris[,<span class="dv">1</span>],<span class="sc">-</span>iris[,<span class="dv">3</span>])</span>
<span id="cb39-13"><a href="Data-preprocessing.html#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # 如果列名不止一个，会将后面的列在前面列的基础上进行排序</span></span>
<span id="cb39-14"><a href="Data-preprocessing.html#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights,year,month,day)</span>
<span id="cb39-15"><a href="Data-preprocessing.html#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="Data-preprocessing.html#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># min_rank()，从小到大排名；需逆向排序的话，加一个desc()</span></span>
<span id="cb39-17"><a href="Data-preprocessing.html#cb39-17" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rank =</span><span class="fu">min_rank</span>(<span class="fu">desc</span>(math)))  <span class="sc">%&gt;%</span></span>
<span id="cb39-18"><a href="Data-preprocessing.html#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(ranks)</span>
<span id="cb39-19"><a href="Data-preprocessing.html#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="Data-preprocessing.html#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="do">### desc 逆排序：</span></span>
<span id="cb39-21"><a href="Data-preprocessing.html#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="fu">df_dup</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(math,sex,<span class="at">decreasing=</span><span class="cn">TRUE</span>) <span class="do">## 反向排序</span></span>
<span id="cb39-22"><a href="Data-preprocessing.html#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="Data-preprocessing.html#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 数据列位置的位移</span></span>
<span id="cb39-24"><a href="Data-preprocessing.html#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co"># select()与everything()连用可以将某几列移到数据库的开头</span></span>
<span id="cb39-25"><a href="Data-preprocessing.html#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights,day,dep_time,<span class="fu">everything</span>())</span></code></pre></div>
</div>
<div id="行列互转" class="section level4 hasAnchor" number="3.3.3.2">
<h4><span class="header-section-number">3.3.3.2</span> 行列互转<a href="Data-preprocessing.html#行列互转" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="Data-preprocessing.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 宽表格变长表格：gather(),melt(),pivot_longer()</span></span>
<span id="cb40-2"><a href="Data-preprocessing.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 长表格变宽表格：spread(),cast(),pivot_wider()</span></span>
<span id="cb40-3"><a href="Data-preprocessing.html#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="Data-preprocessing.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="do">####################### 宽表变长表： ####################</span></span>
<span id="cb40-5"><a href="Data-preprocessing.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 宽矩阵转为长矩阵：</span></span>
<span id="cb40-6"><a href="Data-preprocessing.html#cb40-6" aria-hidden="true" tabindex="-1"></a>reshape2<span class="sc">::</span><span class="fu">melt</span>()</span>
<span id="cb40-7"><a href="Data-preprocessing.html#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="Data-preprocessing.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 宽表变长表：</span></span>
<span id="cb40-9"><a href="Data-preprocessing.html#cb40-9" aria-hidden="true" tabindex="-1"></a>df_q <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span>q,<span class="at">values_from =</span>math_qs,<span class="at">names_prefix =</span><span class="st">&quot;q_&quot;</span>)</span>
<span id="cb40-10"><a href="Data-preprocessing.html#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="Data-preprocessing.html#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="Data-preprocessing.html#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="do">###################### 长表变宽表 ##########################</span></span>
<span id="cb40-13"><a href="Data-preprocessing.html#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="do">###  长表变宽表；</span></span>
<span id="cb40-14"><a href="Data-preprocessing.html#cb40-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;malaria_&quot;</span>),</span>
<span id="cb40-15"><a href="Data-preprocessing.html#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;age_group&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>)</span>
<span id="cb40-16"><a href="Data-preprocessing.html#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="do">## cols:用选择列语法选择要变形的列；</span></span>
<span id="cb40-17"><a href="Data-preprocessing.html#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># names_to:为存放变形列的列名中的值，指定新列名；</span></span>
<span id="cb40-18"><a href="Data-preprocessing.html#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co"># values_to:为存放变形列中的值，指定新列名；</span></span>
<span id="cb40-19"><a href="Data-preprocessing.html#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="Data-preprocessing.html#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 比较gather和spread的用法：均是tidyr包的函数；</span></span>
<span id="cb40-21"><a href="Data-preprocessing.html#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb40-22"><a href="Data-preprocessing.html#cb40-22" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">gather</span>(data, category, value, X, Y, Z)</span>
<span id="cb40-23"><a href="Data-preprocessing.html#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 上面代码是指将data中x、y、z列值转为以分类数据行为基础的数据长矩阵，其中x、y、z原有的值转为列值；</span></span>
<span id="cb40-24"><a href="Data-preprocessing.html#cb40-24" aria-hidden="true" tabindex="-1"></a>spread的用法与gather相反，是将长矩阵转为宽矩阵：</span>
<span id="cb40-25"><a href="Data-preprocessing.html#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="fu">gather</span>(data, category, value, <span class="sc">-</span>time)  <span class="do">## 这里的-time是指被忽略的那一列；</span></span>
<span id="cb40-26"><a href="Data-preprocessing.html#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="Data-preprocessing.html#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="Data-preprocessing.html#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 参见案例如下：</span></span>
<span id="cb40-29"><a href="Data-preprocessing.html#cb40-29" aria-hidden="true" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>www.cnblogs.com<span class="sc">/</span>jialinliu<span class="sc">/</span>p<span class="sc">/</span><span class="fl">15228201.</span>html</span></code></pre></div>
</div>
<div id="列表转数据框" class="section level4 hasAnchor" number="3.3.3.3">
<h4><span class="header-section-number">3.3.3.3</span> 列表转数据框<a href="Data-preprocessing.html#列表转数据框" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="列表常用处理" class="section level6 hasAnchor" number="3.3.3.3.0.1">
<h6><span class="header-section-number">3.3.3.3.0.1</span> 列表常用处理<a href="Data-preprocessing.html#列表常用处理" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="Data-preprocessing.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 代码细节：</span></span>
<span id="cb41-2"><a href="Data-preprocessing.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>() <span class="co"># 将数据进行分为若干个列表； </span></span>
<span id="cb41-3"><a href="Data-preprocessing.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.list</span>() <span class="co"># 将数据收纳为一个列表；</span></span>
<span id="cb41-4"><a href="Data-preprocessing.html#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="Data-preprocessing.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 删除列表的子表：</span></span>
<span id="cb41-6"><a href="Data-preprocessing.html#cb41-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb41-7"><a href="Data-preprocessing.html#cb41-7" aria-hidden="true" tabindex="-1"></a>y[<span class="st">&quot;b&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">NULL</span>)</span>
<span id="cb41-8"><a href="Data-preprocessing.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(y)</span>
<span id="cb41-9"><a href="Data-preprocessing.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-10"><a href="Data-preprocessing.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 列表的赋值定义方法：</span></span>
<span id="cb41-11"><a href="Data-preprocessing.html#cb41-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;u&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>)</span>
<span id="cb41-12"><a href="Data-preprocessing.html#cb41-12" aria-hidden="true" tabindex="-1"></a>lookup <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">m =</span> <span class="st">&quot;Male&quot;</span>, <span class="at">f =</span> <span class="st">&quot;Female&quot;</span>, <span class="at">u =</span> <span class="cn">NA</span>)</span>
<span id="cb41-13"><a href="Data-preprocessing.html#cb41-13" aria-hidden="true" tabindex="-1"></a>lookup[x]</span>
<span id="cb41-14"><a href="Data-preprocessing.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#3 删除对应的属性：</span></span>
<span id="cb41-15"><a href="Data-preprocessing.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(lookup[x])</span>
<span id="cb41-16"><a href="Data-preprocessing.html#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="Data-preprocessing.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 列表调整内部子集的顺序：</span></span>
<span id="cb41-18"><a href="Data-preprocessing.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 前提是设计</span></span>
<span id="cb41-19"><a href="Data-preprocessing.html#cb41-19" aria-hidden="true" tabindex="-1"></a>Freedom <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb41-20"><a href="Data-preprocessing.html#cb41-20" aria-hidden="true" tabindex="-1"></a>Equality <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb41-21"><a href="Data-preprocessing.html#cb41-21" aria-hidden="true" tabindex="-1"></a>TypeCountry <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;South&quot;</span>, <span class="st">&quot;East&quot;</span>, <span class="st">&quot;East&quot;</span>, <span class="st">&quot;North&quot;</span>, <span class="st">&quot;South&quot;</span>, <span class="st">&quot;West&quot;</span>)</span>
<span id="cb41-22"><a href="Data-preprocessing.html#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="Data-preprocessing.html#cb41-23" aria-hidden="true" tabindex="-1"></a>Example <span class="ot">&lt;-</span> <span class="fu">list</span>(Freedom, Equality, TypeCountry)</span>
<span id="cb41-24"><a href="Data-preprocessing.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Example) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Freedom&quot;</span>, <span class="st">&quot;Equality&quot;</span>, <span class="st">&quot;TypeCountry&quot;</span>)</span>
<span id="cb41-25"><a href="Data-preprocessing.html#cb41-25" aria-hidden="true" tabindex="-1"></a>Ex <span class="ot">&lt;-</span> Example[<span class="fu">c</span>(<span class="st">&quot;TypeCountry&quot;</span>,<span class="st">&quot;Freedom&quot;</span>, <span class="st">&quot;Equality&quot;</span>)]</span></code></pre></div>
</div>
<div id="列表与purrr" class="section level6 hasAnchor" number="3.3.3.3.0.2">
<h6><span class="header-section-number">3.3.3.3.0.2</span> 列表与purrr<a href="Data-preprocessing.html#列表与purrr" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="Data-preprocessing.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list_modify()有很多用途，其中之一可以是删除列表元素</span></span>
<span id="cb42-2"><a href="Data-preprocessing.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># keep()保留指定给 的元素.p =，或者提供给 的函数的.p =计算结果为 TRUE</span></span>
<span id="cb42-3"><a href="Data-preprocessing.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># discard()删除指定给 的元素.p，或者提供给的函数.p =计算结果为 TRUE的元素</span></span>
<span id="cb42-4"><a href="Data-preprocessing.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compact()删除所有空元素</span></span>
<span id="cb42-5"><a href="Data-preprocessing.html#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="Data-preprocessing.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 举例：</span></span>
<span id="cb42-7"><a href="Data-preprocessing.html#cb42-7" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="Data-preprocessing.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_modify</span>(<span class="st">&quot;Central Hospital&quot;</span> <span class="ot">=</span> <span class="cn">NULL</span>)   <span class="co"># remove list element by name</span></span>
<span id="cb42-9"><a href="Data-preprocessing.html#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="Data-preprocessing.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only list elements with more than 500 rows</span></span>
<span id="cb42-11"><a href="Data-preprocessing.html#cb42-11" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb42-12"><a href="Data-preprocessing.html#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(<span class="at">.p =</span> <span class="sc">~</span><span class="fu">nrow</span>(.x) <span class="sc">&gt;</span> <span class="dv">500</span>)  </span>
<span id="cb42-13"><a href="Data-preprocessing.html#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="Data-preprocessing.html#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Discard list elements that are not data frames</span></span>
<span id="cb42-15"><a href="Data-preprocessing.html#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 丢弃列表中非数据框的类型数据；</span></span>
<span id="cb42-16"><a href="Data-preprocessing.html#cb42-16" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb42-17"><a href="Data-preprocessing.html#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(<span class="at">.p =</span> <span class="sc">~</span><span class="fu">class</span>(.x) <span class="sc">!=</span> <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb42-18"><a href="Data-preprocessing.html#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="Data-preprocessing.html#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only list elements where ct_blood column mean is over 25</span></span>
<span id="cb42-20"><a href="Data-preprocessing.html#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 深入列表进行计算和筛选：</span></span>
<span id="cb42-21"><a href="Data-preprocessing.html#cb42-21" aria-hidden="true" tabindex="-1"></a>combined <span class="sc">%&gt;%</span> </span>
<span id="cb42-22"><a href="Data-preprocessing.html#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(<span class="at">.p =</span> <span class="sc">~</span><span class="fu">mean</span>(.x<span class="sc">$</span>ct_blood) <span class="sc">&gt;</span> <span class="dv">25</span>)  </span></code></pre></div>
</div>
</div>
<div id="日期数据重塑" class="section level4 hasAnchor" number="3.3.3.4">
<h4><span class="header-section-number">3.3.3.4</span> 日期数据重塑<a href="Data-preprocessing.html#日期数据重塑" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>查看本地环境下的时区设计：
## 查看时区：
Sys.timezone(location = TRUE)</code></pre>
<div id="lubridate" class="section level5 hasAnchor" number="3.3.3.4.1">
<h5><span class="header-section-number">3.3.3.4.1</span> 3.4.1 lubridate<a href="Data-preprocessing.html#lubridate" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="Data-preprocessing.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span>
<span id="cb44-2"><a href="Data-preprocessing.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb44-3"><a href="Data-preprocessing.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">today</span>()  <span class="do">## 查看年月日；</span></span>
<span id="cb44-4"><a href="Data-preprocessing.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>()    <span class="do">## 最详细的日期；</span></span>
<span id="cb44-5"><a href="Data-preprocessing.html#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="Data-preprocessing.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 时间修正形式：</span></span>
<span id="cb44-7"><a href="Data-preprocessing.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;20110604&quot;</span>)</span>
<span id="cb44-8"><a href="Data-preprocessing.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;06-04-2011&quot;</span>)</span>
<span id="cb44-9"><a href="Data-preprocessing.html#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;04/06/2011&quot;</span>)</span>
<span id="cb44-10"><a href="Data-preprocessing.html#cb44-10" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">as_datetime</span>(<span class="st">&quot;2012.04/1612:00:05&quot;</span>)</span>
<span id="cb44-11"><a href="Data-preprocessing.html#cb44-11" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">as_datetime</span>(<span class="fl">44677.4375</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>, <span class="at">origin =</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;1899-12-30 00:00:00&quot;</span>,<span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>))</span>
<span id="cb44-12"><a href="Data-preprocessing.html#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#[1] &quot;2022-04-26 10:30:00 UTC&quot;</span></span>
<span id="cb44-13"><a href="Data-preprocessing.html#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="Data-preprocessing.html#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="Data-preprocessing.html#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 提取信息：</span></span>
<span id="cb44-16"><a href="Data-preprocessing.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用下面这些函数直接提取对应数据中参数值：</span></span>
<span id="cb44-17"><a href="Data-preprocessing.html#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co"># minute、hour、day、wday、yday、week、month、year</span></span>
<span id="cb44-18"><a href="Data-preprocessing.html#cb44-18" aria-hidden="true" tabindex="-1"></a>arrive <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2011-06-04 12:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;Pacific/Auckland&quot;</span>)</span>
<span id="cb44-19"><a href="Data-preprocessing.html#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(arrive) <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb44-20"><a href="Data-preprocessing.html#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="Data-preprocessing.html#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 修改时间：</span></span>
<span id="cb44-22"><a href="Data-preprocessing.html#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="dv">20110101</span>) <span class="sc">+</span> <span class="fu">dyears</span>(<span class="dv">1</span>)</span>
<span id="cb44-23"><a href="Data-preprocessing.html#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2012-01-01 06:00:00 UTC&quot;</span></span>
<span id="cb44-24"><a href="Data-preprocessing.html#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="dv">20110101</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb44-25"><a href="Data-preprocessing.html#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2012-01-01&quot;</span></span></code></pre></div>
</div>
<div id="base-r-date" class="section level5 hasAnchor" number="3.3.3.4.2">
<h5><span class="header-section-number">3.3.3.4.2</span> 3.4.2 base-r-date<a href="Data-preprocessing.html#base-r-date" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="Data-preprocessing.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 规整日期；</span></span>
<span id="cb45-2"><a href="Data-preprocessing.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2012/12/14&quot;</span>)</span>
<span id="cb45-3"><a href="Data-preprocessing.html#cb45-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;2012-12-14&quot;</span></span>
<span id="cb45-4"><a href="Data-preprocessing.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(index_date, <span class="at">format=</span><span class="st">&#39;%Y-%m-%d&#39;</span>),</span>
<span id="cb45-5"><a href="Data-preprocessing.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(admission_dt, <span class="at">format=</span><span class="st">&#39;%Y-%m-%d&#39;</span>),units<span class="ot">=</span><span class="st">&#39;days&#39;</span><span class="er">)))))</span>  </span>
<span id="cb45-6"><a href="Data-preprocessing.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="Data-preprocessing.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 组建时间：</span></span>
<span id="cb45-8"><a href="Data-preprocessing.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make_data</span>(<span class="dv">2020</span>,<span class="dv">8</span>,<span class="dv">27</span> ) <span class="co"># 输出&quot;2020-08-27&quot;</span></span>
<span id="cb45-9"><a href="Data-preprocessing.html#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">make_datatime</span>(<span class="dv">2020</span>,<span class="dv">8</span>,<span class="dv">27</span>,<span class="dv">21</span>,<span class="dv">27</span>,<span class="dv">15</span>)  <span class="dv">2020-08-27</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">27</span><span class="sc">:</span><span class="dv">15</span> UTc</span>
<span id="cb45-10"><a href="Data-preprocessing.html#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="Data-preprocessing.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 还可以使用format来构建函数：</span></span>
<span id="cb45-12"><a href="Data-preprocessing.html#cb45-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">make_data</span>(<span class="dv">2020</span>,<span class="dv">3</span>,<span class="dv">5</span>)</span>
<span id="cb45-13"><a href="Data-preprocessing.html#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(d ,<span class="st">&quot;%Y/%m/%d&quot;</span>)</span>
<span id="cb45-14"><a href="Data-preprocessing.html#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="Data-preprocessing.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 时间序列分析：</span></span>
<span id="cb45-16"><a href="Data-preprocessing.html#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(data, <span class="at">start =</span><span class="dv">1</span>, end, <span class="at">frequency =</span><span class="dv">1</span>, ...)函数：</span>
<span id="cb45-17"><a href="Data-preprocessing.html#cb45-17" aria-hidden="true" tabindex="-1"></a>其中data为数值向量或矩阵；start设置起始时刻；end设置结束时刻；</span>
<span id="cb45-18"><a href="Data-preprocessing.html#cb45-18" aria-hidden="true" tabindex="-1"></a>frequency设置时间频率，默认为1；当填入4时表示季度；填入12表示月份；</span>
<span id="cb45-19"><a href="Data-preprocessing.html#cb45-19" aria-hidden="true" tabindex="-1"></a>例如：</span>
<span id="cb45-20"><a href="Data-preprocessing.html#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(<span class="at">data =</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">start =</span><span class="dv">2010</span>,<span class="at">frequency =</span><span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="计算时间差" class="section level5 hasAnchor" number="3.3.3.4.3">
<h5><span class="header-section-number">3.3.3.4.3</span> 3.4.3 计算时间差：<a href="Data-preprocessing.html#计算时间差" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="Data-preprocessing.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取时间差：</span></span>
<span id="cb46-2"><a href="Data-preprocessing.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> a <span class="ot">&lt;-</span> <span class="st">&#39;2016-06-02 23:29:00&#39;</span></span>
<span id="cb46-3"><a href="Data-preprocessing.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> b <span class="ot">&lt;-</span> <span class="st">&#39;2016-06-05 03:24:00&#39;</span></span>
<span id="cb46-4"><a href="Data-preprocessing.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">as.double</span>(<span class="fu">difftime</span>(b,a))</span>
<span id="cb46-5"><a href="Data-preprocessing.html#cb46-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">2.163194</span></span>
<span id="cb46-6"><a href="Data-preprocessing.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">as.double</span>(<span class="fu">difftime</span>(b,a,<span class="at">units=</span><span class="st">&quot;weeks&quot;</span>))</span>
<span id="cb46-7"><a href="Data-preprocessing.html#cb46-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.3090278</span></span>
<span id="cb46-8"><a href="Data-preprocessing.html#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">#还可以指定units</span></span>
<span id="cb46-9"><a href="Data-preprocessing.html#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">as.double</span>(<span class="fu">difftime</span>(b,a,<span class="at">units=</span><span class="st">&quot;weeks&quot;</span>), <span class="at">units =</span> <span class="st">&#39;days&#39;</span>)</span>
<span id="cb46-10"><a href="Data-preprocessing.html#cb46-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">2.163194</span></span>
<span id="cb46-11"><a href="Data-preprocessing.html#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="Data-preprocessing.html#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 计算时间差的其他方法：</span></span>
<span id="cb46-13"><a href="Data-preprocessing.html#cb46-13" aria-hidden="true" tabindex="-1"></a>inpatient_time <span class="ot">=</span> <span class="fu">as.integer</span>(discharge_datetime <span class="sc">-</span> admission_datetime)</span>
<span id="cb46-14"><a href="Data-preprocessing.html#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="Data-preprocessing.html#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 计算时间差：</span></span>
<span id="cb46-16"><a href="Data-preprocessing.html#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="fu">as.period</span>(<span class="fu">interval</span>(birthDate, refDate), <span class="at">unit =</span> <span class="st">&#39;year&#39;</span>)<span class="sc">$</span>year</span>
<span id="cb46-17"><a href="Data-preprocessing.html#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="Data-preprocessing.html#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 计算时间差：</span></span>
<span id="cb46-19"><a href="Data-preprocessing.html#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">time_length</span>(<span class="fu">interval</span>(index_date, </span>
<span id="cb46-20"><a href="Data-preprocessing.html#cb46-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-31&quot;</span>)), <span class="st">&#39;month&#39;</span>))</span>
<span id="cb46-21"><a href="Data-preprocessing.html#cb46-21" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
</div>
</div>
<div id="数据提取" class="section level3 hasAnchor" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> 数据提取<a href="Data-preprocessing.html#数据提取" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="字符串提取" class="section level4 hasAnchor" number="3.3.4.1">
<h4><span class="header-section-number">3.3.4.1</span> 字符串提取<a href="Data-preprocessing.html#字符串提取" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="Data-preprocessing.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 查看字符的正则类型：</span></span>
<span id="cb47-2"><a href="Data-preprocessing.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 查看字符的正则类型：</span></span>
<span id="cb47-3"><a href="Data-preprocessing.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 正则表达式：</span></span>
<span id="cb47-4"><a href="Data-preprocessing.html#cb47-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;New theme&quot;</span>, <span class="st">&quot;Old times&quot;</span>, <span class="st">&quot;In the present theme&quot;</span>)</span>
<span id="cb47-5"><a href="Data-preprocessing.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">&quot;the&quot;</span>)</span></code></pre></div>
<div id="字符串统计与转换" class="section level5 hasAnchor" number="3.3.4.1.1">
<h5><span class="header-section-number">3.3.4.1.1</span> 字符串统计与转换：<a href="Data-preprocessing.html#字符串统计与转换" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="Data-preprocessing.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## R语言字符串处理：</span></span>
<span id="cb48-2"><a href="Data-preprocessing.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="do">################# 统计字符串长度： ########################</span></span>
<span id="cb48-3"><a href="Data-preprocessing.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb48-4"><a href="Data-preprocessing.html#cb48-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;abcd&#39;</span>, <span class="dv">1379</span>, <span class="st">&#39;偷闲阁&#39;</span>, <span class="cn">NA</span>)</span>
<span id="cb48-5"><a href="Data-preprocessing.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(x)</span>
<span id="cb48-6"><a href="Data-preprocessing.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(x, <span class="at">type =</span> <span class="st">&#39;bytes&#39;</span>)</span>
<span id="cb48-7"><a href="Data-preprocessing.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">nchar</span>(x, <span class="at">keepNA =</span> F)</span>
<span id="cb48-8"><a href="Data-preprocessing.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nzchar</span>(x)</span>
<span id="cb48-9"><a href="Data-preprocessing.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;bc&quot;</span>, <span class="st">&quot;def&quot;</span>, <span class="st">&quot;北京&quot;</span>))</span>
<span id="cb48-10"><a href="Data-preprocessing.html#cb48-10" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div id="字符串连接构建删除" class="section level5 hasAnchor" number="3.3.4.1.2">
<h5><span class="header-section-number">3.3.4.1.2</span> 字符串连接、构建、删除：<a href="Data-preprocessing.html#字符串连接构建删除" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="Data-preprocessing.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">###################### 字符串 连接  ########################</span></span>
<span id="cb49-2"><a href="Data-preprocessing.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="do">## base -R - 连接；</span></span>
<span id="cb49-3"><a href="Data-preprocessing.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>() 函数；</span>
<span id="cb49-4"><a href="Data-preprocessing.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>()</span>
<span id="cb49-5"><a href="Data-preprocessing.html#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="Data-preprocessing.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符连接：</span></span>
<span id="cb49-7"><a href="Data-preprocessing.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb49-8"><a href="Data-preprocessing.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="at">sep=</span><span class="st">&quot;*&quot;</span>)</span>
<span id="cb49-9"><a href="Data-preprocessing.html#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;data&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">&quot;.txt&quot;</span>) <span class="do">## 类似与paste0</span></span>
<span id="cb49-10"><a href="Data-preprocessing.html#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;x&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">sep =</span> <span class="st">&quot;&quot;</span>,<span class="at">collaspse =</span> <span class="st">&quot;_&quot;</span>)  <span class="co"># 输出结果为：&quot;x1_x2_x3&quot;</span></span>
<span id="cb49-11"><a href="Data-preprocessing.html#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="Data-preprocessing.html#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符连接：</span></span>
<span id="cb49-13"><a href="Data-preprocessing.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;hh&quot;</span>,<span class="st">&quot;123&quot;</span>)</span>
<span id="cb49-14"><a href="Data-preprocessing.html#cb49-14" aria-hidden="true" tabindex="-1"></a>output_file <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;outputs/Report_{Sys.Date()}.docx&quot;</span>)</span>
<span id="cb49-15"><a href="Data-preprocessing.html#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="Data-preprocessing.html#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="Data-preprocessing.html#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="do">########################## 字符构建： ########################</span></span>
<span id="cb49-18"><a href="Data-preprocessing.html#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="fu">str_dup</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>),<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)) <span class="co"># 输出为  [1] &quot;aaa&quot; &quot;bb&quot;</span></span>
<span id="cb49-19"><a href="Data-preprocessing.html#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用正则匹配来实现字符串构建：interesting！</span></span>
<span id="cb49-20"><a href="Data-preprocessing.html#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;tour%03d.jpg&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">100</span>))</span>
<span id="cb49-21"><a href="Data-preprocessing.html#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符串中插入变量值：</span></span>
<span id="cb49-22"><a href="Data-preprocessing.html#cb49-22" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="st">&quot;李明&quot;</span></span>
<span id="cb49-23"><a href="Data-preprocessing.html#cb49-23" aria-hidden="true" tabindex="-1"></a>tele <span class="ot">&lt;-</span> <span class="st">&quot;13512345678&quot;</span></span>
<span id="cb49-24"><a href="Data-preprocessing.html#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;姓名: {name}</span><span class="sc">\n</span><span class="st">电话号码: {tele}</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb49-25"><a href="Data-preprocessing.html#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue_data</span>(<span class="fu">list</span>(<span class="at">name =</span> <span class="st">&quot;王五&quot;</span>, <span class="at">tele =</span> <span class="st">&quot;13500000000&quot;</span>),</span>
<span id="cb49-26"><a href="Data-preprocessing.html#cb49-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;姓名: {name}&quot;</span>, <span class="st">&quot;电话号码: {tele}&quot;</span>, <span class="at">.sep=</span><span class="st">&quot;; &quot;</span>)</span>
<span id="cb49-27"><a href="Data-preprocessing.html#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="Data-preprocessing.html#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="do">######################## 字符串删除 ##########################</span></span>
<span id="cb49-29"><a href="Data-preprocessing.html#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 去掉空白字符串：</span></span>
<span id="cb49-30"><a href="Data-preprocessing.html#cb49-30" aria-hidden="true" tabindex="-1"></a>tt[<span class="fu">nchar</span>(x)<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb49-31"><a href="Data-preprocessing.html#cb49-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-32"><a href="Data-preprocessing.html#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 移除字符集中的空格：</span></span>
<span id="cb49-33"><a href="Data-preprocessing.html#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(<span class="fu">c</span>(<span class="st">&quot;a  &quot;</span>,<span class="st">&quot;b  &quot;</span>, <span class="st">&quot;a b&quot;</span>))</span>
<span id="cb49-34"><a href="Data-preprocessing.html#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] &quot;a&quot; &quot;b&quot; &quot;a b&quot;</span></span>
<span id="cb49-35"><a href="Data-preprocessing.html#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 选项which=&quot;left&quot;可以仅删去开头的空格， 选项which=&quot;right&quot;可以仅删去结尾的空格。</span></span>
<span id="cb49-36"><a href="Data-preprocessing.html#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="fu">trimws</span>(<span class="fu">c</span>(<span class="st">&quot;  李明&quot;</span>, <span class="st">&quot;李明  &quot;</span>, <span class="st">&quot;  李明  &quot;</span>, <span class="st">&quot;李  明&quot;</span>), <span class="at">which=</span><span class="st">&quot;left&quot;</span>)</span></code></pre></div>
</div>
<div id="字符位置排序与检索" class="section level5 hasAnchor" number="3.3.4.1.3">
<h5><span class="header-section-number">3.3.4.1.3</span> 字符位置排序与检索<a href="Data-preprocessing.html#字符位置排序与检索" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="Data-preprocessing.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################### 字符排序 ################</span></span>
<span id="cb50-2"><a href="Data-preprocessing.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sort</span>(x ,decreasing,locale , ....) <span class="co"># locale可指定语言，默认为en，可变为&quot;ch&quot;。并且这种排序方法会改变字符串的序列，按照汉语拼音的方法；</span></span>
<span id="cb50-3"><a href="Data-preprocessing.html#cb50-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;banana&quot;</span>,<span class="st">&quot;apple&quot;</span>,<span class="st">&quot;pear&quot;</span>)</span>
<span id="cb50-4"><a href="Data-preprocessing.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sort</span>(x)</span>
<span id="cb50-5"><a href="Data-preprocessing.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [1]  &quot;apple&quot;, &quot;banana&quot;,  &quot;pear&quot;</span></span>
<span id="cb50-6"><a href="Data-preprocessing.html#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="Data-preprocessing.html#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="Data-preprocessing.html#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="do">##################### 字符位置查询 ################# </span></span>
<span id="cb50-9"><a href="Data-preprocessing.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="do">### 主要有grepl()和grep()函数：</span></span>
<span id="cb50-10"><a href="Data-preprocessing.html#cb50-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;describe&#39;</span>, <span class="st">&#39;the&#39;</span>, <span class="st">&#39;city&#39;</span>, <span class="st">&#39;you&#39;</span>, <span class="st">&#39;live&#39;</span>, <span class="st">&#39;in&#39;</span>)</span>
<span id="cb50-11"><a href="Data-preprocessing.html#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符检索grep--返回下标数字：</span></span>
<span id="cb50-12"><a href="Data-preprocessing.html#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&#39;i&#39;</span>, x) <span class="do">## 检索下标 [1] 1 3 5 6</span></span>
<span id="cb50-13"><a href="Data-preprocessing.html#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&#39;i&#39;</span>, x, <span class="at">invert =</span> T) <span class="co"># 返回不匹配的选项；</span></span>
<span id="cb50-14"><a href="Data-preprocessing.html#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&#39;i&#39;</span>, x, <span class="at">value =</span> T) <span class="co"># 返回检索值；</span></span>
<span id="cb50-15"><a href="Data-preprocessing.html#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="Data-preprocessing.html#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符检索grepl-- 返回逻辑值：</span></span>
<span id="cb50-17"><a href="Data-preprocessing.html#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&#39;i&#39;</span>, x) <span class="sc">--</span> true<span class="sc">/</span>false </span>
<span id="cb50-18"><a href="Data-preprocessing.html#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="fu">startsWith</span>(<span class="fu">c</span>(<span class="st">&quot;xyz123&quot;</span>, <span class="st">&quot;tu004&quot;</span>), <span class="st">&quot;tu&quot;</span>) <span class="co"># 条件判断并范湖逻辑值；</span></span>
<span id="cb50-19"><a href="Data-preprocessing.html#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="Data-preprocessing.html#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符检索regexpr- regexec：</span></span>
<span id="cb50-21"><a href="Data-preprocessing.html#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符返回位置：结果包含了匹配的具体位置和字符串长度信息</span></span>
<span id="cb50-22"><a href="Data-preprocessing.html#cb50-22" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Hellow,Adam!&quot;</span>, <span class="st">&quot;Hi, Adam!&quot;</span>) </span>
<span id="cb50-23"><a href="Data-preprocessing.html#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="fu">regexpr</span>(<span class="st">&quot;Adam&quot;</span>, text)  <span class="do">## 返回具体位置</span></span>
<span id="cb50-24"><a href="Data-preprocessing.html#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="fu">gregexpr</span>(<span class="st">&quot;Adam&quot;</span>, text) <span class="co"># 下面两个返回的结果是相似；</span></span>
<span id="cb50-25"><a href="Data-preprocessing.html#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="fu">regexec</span>(<span class="st">&quot;Adam&quot;</span>, text) </span>
<span id="cb50-26"><a href="Data-preprocessing.html#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="Data-preprocessing.html#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 基于string包中的str_（）相关匹配函数：</span></span>
<span id="cb50-28"><a href="Data-preprocessing.html#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(string, pattern, <span class="at">negaate =</span><span class="cn">FALSE</span>) 检测是否存在匹配；</span>
<span id="cb50-29"><a href="Data-preprocessing.html#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="fu">str_which</span>(string,pattern,<span class="at">negate =</span> <span class="cn">FALSE</span>) _查找匹配的索引；</span>
<span id="cb50-30"><a href="Data-preprocessing.html#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(string, pattern) ：计算匹配的次数</span>
<span id="cb50-31"><a href="Data-preprocessing.html#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(string, pattern) ：定位匹配的位置，返回end和start；</span>
<span id="cb50-32"><a href="Data-preprocessing.html#cb50-32" aria-hidden="true" tabindex="-1"></a>str <span class="fu">starts</span>( string, pattern) <span class="sc">:</span> 检测是否以pattern开头</span>
<span id="cb50-33"><a href="Data-preprocessing.html#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str_ends</span>(string, pattern) <span class="sc">:</span> 检测是否以pattern结尾</span>
<span id="cb50-34"><a href="Data-preprocessing.html#cb50-34" aria-hidden="true" tabindex="-1"></a>    string<span class="sc">:</span>为要检测的字符串</span>
<span id="cb50-35"><a href="Data-preprocessing.html#cb50-35" aria-hidden="true" tabindex="-1"></a>    pattern<span class="sc">:</span>为匹配的模式,可以是正则表达式</span>
<span id="cb50-36"><a href="Data-preprocessing.html#cb50-36" aria-hidden="true" tabindex="-1"></a>    negate<span class="sc">:</span>默认为 FALSE表示正常匹配,若为TRUE则反匹配(找不匹配)。</span></code></pre></div>
</div>
<div id="字符串转换替换" class="section level5 hasAnchor" number="3.3.4.1.4">
<h5><span class="header-section-number">3.3.4.1.4</span> 字符串转换/替换：<a href="Data-preprocessing.html#字符串转换替换" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="Data-preprocessing.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">######################## 字符串 转换 ###############################</span></span>
<span id="cb51-2"><a href="Data-preprocessing.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 大小写转换：</span></span>
<span id="cb51-3"><a href="Data-preprocessing.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>()</span>
<span id="cb51-4"><a href="Data-preprocessing.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">toupper</span>()</span>
<span id="cb51-5"><a href="Data-preprocessing.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="Data-preprocessing.html#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 批量将字符串转为数值型数据：</span></span>
<span id="cb51-7"><a href="Data-preprocessing.html#cb51-7" aria-hidden="true" tabindex="-1"></a>xh2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(xh[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],as.numeric)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>(.,xh[,<span class="dv">3</span>])</span>
<span id="cb51-8"><a href="Data-preprocessing.html#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="Data-preprocessing.html#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 批量构建循环体中的字符串： </span></span>
<span id="cb51-10"><a href="Data-preprocessing.html#cb51-10" aria-hidden="true" tabindex="-1"></a>explanatory_vars <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(<span class="st">&quot;outcome ~ &quot;</span>, .)</span>
<span id="cb51-11"><a href="Data-preprocessing.html#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="Data-preprocessing.html#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符串格式化输出：将字符串转为变量名：</span></span>
<span id="cb51-13"><a href="Data-preprocessing.html#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="fu">str_splot_fixed</span>(string,pattern ,n) <span class="co"># 返回矩阵，n控制行数；</span></span>
<span id="cb51-14"><a href="Data-preprocessing.html#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="Data-preprocessing.html#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="do">######################## 字符串 替换 ##############################</span></span>
<span id="cb51-16"><a href="Data-preprocessing.html#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="do">### 字符筛选后替换：chartr</span></span>
<span id="cb51-17"><a href="Data-preprocessing.html#cb51-17" aria-hidden="true" tabindex="-1"></a>DNA <span class="ot">&lt;-</span> <span class="st">&quot;AtGCtttACC&quot;</span></span>
<span id="cb51-18"><a href="Data-preprocessing.html#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="fu">chartr</span>(<span class="st">&quot;Tt&quot;</span>,<span class="st">&quot;Bb&quot;</span>,DNA) <span class="do">## 转为小写</span></span>
<span id="cb51-19"><a href="Data-preprocessing.html#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu">chartr</span>(<span class="st">&quot;Tt&quot;</span>,<span class="st">&quot;BB&quot;</span>,DNA) <span class="do">## 转为大写</span></span>
<span id="cb51-20"><a href="Data-preprocessing.html#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="fu">chartr</span>(<span class="st">&quot;!;&quot;</span>, <span class="st">&quot;.,&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Hi; boy!&quot;</span>, <span class="st">&quot;How do you do!&quot;</span>)) <span class="do">## 多条件替换；</span></span>
<span id="cb51-21"><a href="Data-preprocessing.html#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="Data-preprocessing.html#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符查询位置后替换：base-sub、gsub</span></span>
<span id="cb51-23"><a href="Data-preprocessing.html#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="do">## sub 只做一次检索替换：</span></span>
<span id="cb51-24"><a href="Data-preprocessing.html#cb51-24" aria-hidden="true" tabindex="-1"></a>text<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;Hello, Adam&quot;</span>,<span class="st">&quot;Hi,Adam!Adam!&quot;</span>,<span class="st">&quot;How are you,Ava&quot;</span>)</span>
<span id="cb51-25"><a href="Data-preprocessing.html#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span>(<span class="at">pattern=</span><span class="st">&quot;Adam&quot;</span>,<span class="at">replacement=</span><span class="st">&quot;word&quot;</span>,text) <span class="do">##在该输出结果中&quot;Hi,word!Adam!&quot;</span></span>
<span id="cb51-26"><a href="Data-preprocessing.html#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="Data-preprocessing.html#cb51-27" aria-hidden="true" tabindex="-1"></a><span class="do">## gsub 遇到即发生替换</span></span>
<span id="cb51-28"><a href="Data-preprocessing.html#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="at">pattern=</span><span class="st">&quot;Adam|Ava&quot;</span>,<span class="at">replacement=</span><span class="st">&quot;word&quot;</span>,text)</span>
<span id="cb51-29"><a href="Data-preprocessing.html#cb51-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Hello, word&quot;</span>      <span class="st">&quot;Hi,word!&quot;</span>         <span class="st">&quot;How are you,word&quot;</span></span>
<span id="cb51-30"><a href="Data-preprocessing.html#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="Data-preprocessing.html#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符查询位置后替换：string-str_sub:</span></span>
<span id="cb51-32"><a href="Data-preprocessing.html#cb51-32" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="st">&quot;term2017&quot;</span> </span>
<span id="cb51-33"><a href="Data-preprocessing.html#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(s, <span class="dv">5</span>, <span class="dv">8</span>) <span class="ot">&lt;-</span> <span class="st">&quot;18&quot;</span> <span class="do">## 返回&quot;term18&quot;</span></span>
<span id="cb51-34"><a href="Data-preprocessing.html#cb51-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-35"><a href="Data-preprocessing.html#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="do">## substr替换</span></span>
<span id="cb51-36"><a href="Data-preprocessing.html#cb51-36" aria-hidden="true" tabindex="-1"></a><span class="do">##　substr(x,from,to) </span></span>
<span id="cb51-37"><a href="Data-preprocessing.html#cb51-37" aria-hidden="true" tabindex="-1"></a>hh <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ahbdhfdf&quot;</span>)</span>
<span id="cb51-38"><a href="Data-preprocessing.html#cb51-38" aria-hidden="true" tabindex="-1"></a><span class="fu">substr</span>(hh,<span class="dv">2</span>,<span class="dv">4</span>) <span class="ot">&lt;-</span> <span class="st">&#39; jjj&#39;</span></span>
<span id="cb51-39"><a href="Data-preprocessing.html#cb51-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-40"><a href="Data-preprocessing.html#cb51-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 字符串提取后替换：</span></span>
<span id="cb51-41"><a href="Data-preprocessing.html#cb51-41" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(string,pattern,replacement)</span>
<span id="cb51-42"><a href="Data-preprocessing.html#cb51-42" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(x,<span class="st">&quot;-&quot;</span>,<span class="st">&quot;/&quot;</span>) <span class="co"># 将-转为/</span></span></code></pre></div>
</div>
<div id="字符串拆分提取" class="section level5 hasAnchor" number="3.3.4.1.5">
<h5><span class="header-section-number">3.3.4.1.5</span> 字符串拆分/提取：<a href="Data-preprocessing.html#字符串拆分提取" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="Data-preprocessing.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################  拆分 ###################</span></span>
<span id="cb52-2"><a href="Data-preprocessing.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="do">### base-R:</span></span>
<span id="cb52-3"><a href="Data-preprocessing.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(x, split, <span class="at">fixed =</span> <span class="cn">FALSE</span>, <span class="at">perl =</span> <span class="cn">FALSE</span>, <span class="at">useBytes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-4"><a href="Data-preprocessing.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 注意：</span></span>
<span id="cb52-5"><a href="Data-preprocessing.html#cb52-5" aria-hidden="true" tabindex="-1"></a>1、split为特殊字符时，使用“[<span class="sc">$</span>]”来进行分割；</span>
<span id="cb52-6"><a href="Data-preprocessing.html#cb52-6" aria-hidden="true" tabindex="-1"></a>2、strsplit分割后，split作为分割字符串不再保留；</span>
<span id="cb52-7"><a href="Data-preprocessing.html#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="Data-preprocessing.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="do">### library(stringr)</span></span>
<span id="cb52-9"><a href="Data-preprocessing.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(string, pattern, <span class="at">n =</span> <span class="cn">Inf</span>, <span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="do">## 返回列表，与strsplit类似；</span></span>
<span id="cb52-10"><a href="Data-preprocessing.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str_splot_fixed</span>(string,pattern ,n) <span class="co"># 返回矩阵，n控制行数；</span></span>
<span id="cb52-11"><a href="Data-preprocessing.html#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="Data-preprocessing.html#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 拆分数字并提取：</span></span>
<span id="cb52-13"><a href="Data-preprocessing.html#cb52-13" aria-hidden="true" tabindex="-1"></a>drug_spec_unit <span class="ot">=</span> <span class="fu">as.numeric</span>(readr<span class="sc">::</span><span class="fu">parse_number</span>(drug_spec_unit))</span>
<span id="cb52-14"><a href="Data-preprocessing.html#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="Data-preprocessing.html#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="do">######################## 提取 #######################</span></span>
<span id="cb52-16"><a href="Data-preprocessing.html#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 提取string - substr/str_sub</span></span>
<span id="cb52-17"><a href="Data-preprocessing.html#cb52-17" aria-hidden="true" tabindex="-1"></a>substr<span class="sc">/</span>(x, start, stop)  <span class="do">## 给定范围提取：</span></span>
<span id="cb52-18"><a href="Data-preprocessing.html#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="fu">substring</span>(text, first, <span class="at">last =</span> 1000000L) </span>
<span id="cb52-19"><a href="Data-preprocessing.html#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="st">&quot;123456789&quot;</span> </span>
<span id="cb52-20"><a href="Data-preprocessing.html#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(x,<span class="dv">5</span>,<span class="dv">8</span>)  <span class="do">## 5678</span></span>
<span id="cb52-21"><a href="Data-preprocessing.html#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">substr</span>(x, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>)) </span>
<span id="cb52-22"><a href="Data-preprocessing.html#cb52-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;234&quot;</span> </span>
<span id="cb52-23"><a href="Data-preprocessing.html#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">substring</span>(x, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>)) </span>
<span id="cb52-24"><a href="Data-preprocessing.html#cb52-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;234&quot;</span>     <span class="st">&quot;45&quot;</span>      <span class="st">&quot;2345678&quot;</span> </span>
<span id="cb52-25"><a href="Data-preprocessing.html#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-26"><a href="Data-preprocessing.html#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 基于str_split()</span></span>
<span id="cb52-27"><a href="Data-preprocessing.html#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(string,pattern) <span class="do">## 返回列表；</span></span>
<span id="cb52-28"><a href="Data-preprocessing.html#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="fu">str_splot_fixed</span>(string,pattern ,n) <span class="co"># 返回矩阵，n控制行数；</span></span>
<span id="cb52-29"><a href="Data-preprocessing.html#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="Data-preprocessing.html#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 基于正则提取：</span></span>
<span id="cb52-31"><a href="Data-preprocessing.html#cb52-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取所有中文字符：</span></span>
<span id="cb52-32"><a href="Data-preprocessing.html#cb52-32" aria-hidden="true" tabindex="-1"></a>words_vec <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(poem_autumnwindow, <span class="st">&quot;[[:alpha:]]&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb52-33"><a href="Data-preprocessing.html#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(words_vec)</span>
<span id="cb52-34"><a href="Data-preprocessing.html#cb52-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-35"><a href="Data-preprocessing.html#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取数字：</span></span>
<span id="cb52-36"><a href="Data-preprocessing.html#cb52-36" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;10-0.16-1700.0-42.csv&quot;</span>, <span class="st">&quot;12-0.22-1799.1.csv&quot;</span>)</span>
<span id="cb52-37"><a href="Data-preprocessing.html#cb52-37" aria-hidden="true" tabindex="-1"></a>pat <span class="ot">&lt;-</span> <span class="st">&quot;[0-9]+[.][0-9]+|[0-9]+&quot;</span></span>
<span id="cb52-38"><a href="Data-preprocessing.html#cb52-38" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">str_match_all</span>(s, pat); s1</span>
<span id="cb52-39"><a href="Data-preprocessing.html#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="Data-preprocessing.html#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 正则匹配提取：str_extract()和str_match()</span></span>
<span id="cb52-41"><a href="Data-preprocessing.html#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(string,pattern) <span class="sc">:</span>只提取匹配的内容；</span>
<span id="cb52-42"><a href="Data-preprocessing.html#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="fu">str_match</span>(string,pattern) ：提取匹配的内容以及各个分组捕获，返回结果矩阵；</span>
<span id="cb52-43"><a href="Data-preprocessing.html#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;1978-2000&quot;</span>,<span class="st">&quot;2011-2020-2099&quot;</span>)</span>
<span id="cb52-44"><a href="Data-preprocessing.html#cb52-44" aria-hidden="true" tabindex="-1"></a>pat<span class="ot">&lt;-</span><span class="st">&quot;</span><span class="sc">\b</span><span class="st">(19|20)([e-9]{2})</span><span class="sc">\b</span><span class="st">&quot;</span> <span class="co">#正则表达式</span></span>
<span id="cb52-45"><a href="Data-preprocessing.html#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, pat)</span>
<span id="cb52-46"><a href="Data-preprocessing.html#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="do">##[1]&quot;1978&quot;&quot;2011&quot;</span></span>
<span id="cb52-47"><a href="Data-preprocessing.html#cb52-47" aria-hidden="true" tabindex="-1"></a><span class="fu">str_match</span>(x, pat)</span>
<span id="cb52-48"><a href="Data-preprocessing.html#cb52-48" aria-hidden="true" tabindex="-1"></a>    [,<span class="dv">1</span>] [,<span class="dv">2</span>] [,<span class="dv">3</span>]</span>
<span id="cb52-49"><a href="Data-preprocessing.html#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="do">##[1,]&quot;1978&quot;&quot;19&quot;&quot;78&quot;</span></span>
<span id="cb52-50"><a href="Data-preprocessing.html#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="do">##[2,]&quot;2011&quot;&quot;26&quot;&quot;11</span></span>
<span id="cb52-51"><a href="Data-preprocessing.html#cb52-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-52"><a href="Data-preprocessing.html#cb52-52" aria-hidden="true" tabindex="-1"></a><span class="do">## 利用正则仅提取数据：</span></span>
<span id="cb52-53"><a href="Data-preprocessing.html#cb52-53" aria-hidden="true" tabindex="-1"></a><span class="fu">str_match_all</span>( <span class="st">&quot;[0-9]+[.][0-9]+|[0-9]+&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="列批量提取" class="section level4 hasAnchor" number="3.3.4.2">
<h4><span class="header-section-number">3.3.4.2</span> 列批量提取<a href="Data-preprocessing.html#列批量提取" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="Data-preprocessing.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 快速数据框处理：</span></span>
<span id="cb53-2"><a href="Data-preprocessing.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb53-3"><a href="Data-preprocessing.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用select函数筛选：</span></span>
<span id="cb53-4"><a href="Data-preprocessing.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="do">############################### select选择特定的列；</span></span>
<span id="cb53-5"><a href="Data-preprocessing.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights,year<span class="sc">:</span>day)</span>
<span id="cb53-6"><a href="Data-preprocessing.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb53-7"><a href="Data-preprocessing.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>()函数可以搭配使用一些辅助函数：</span>
<span id="cb53-8"><a href="Data-preprocessing.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu">starts_with</span>(“abc”)：匹配以abc开头的名称</span>
<span id="cb53-9"><a href="Data-preprocessing.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="fu">end_with</span>(abc)：匹配以abc结尾的名称</span>
<span id="cb53-10"><a href="Data-preprocessing.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="fu">contains</span>(“xyz”)：匹配含xyz的名称</span>
<span id="cb53-11"><a href="Data-preprocessing.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="fu">matches</span>(“”)</span>
<span id="cb53-12"><a href="Data-preprocessing.html#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="fu">num_range</span>(“x”，1：<span class="dv">3</span>)：匹配x1，x2，x3</span>
<span id="cb53-13"><a href="Data-preprocessing.html#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># .col用于指定列，.fns用于对指定列进行函数运算；</span></span>
<span id="cb53-14"><a href="Data-preprocessing.html#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(<span class="at">.col =</span><span class="fu">everything</span>(),<span class="at">.fns =</span><span class="cn">NULL</span>,...,.names)</span>
<span id="cb53-15"><a href="Data-preprocessing.html#cb53-15" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span>  <span class="do">## 选定所有列，进行归一化；</span></span>
<span id="cb53-16"><a href="Data-preprocessing.html#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),rescale)) </span>
<span id="cb53-17"><a href="Data-preprocessing.html#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="Data-preprocessing.html#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="Data-preprocessing.html#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="Data-preprocessing.html#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co"># select()与everything()连用可以将某几列移到数据库的开头</span></span>
<span id="cb53-21"><a href="Data-preprocessing.html#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights,day,dep_time,<span class="fu">everything</span>())</span>
<span id="cb53-22"><a href="Data-preprocessing.html#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="Data-preprocessing.html#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="do">## select()函数的其他用法：</span></span>
<span id="cb53-24"><a href="Data-preprocessing.html#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(name, sex<span class="sc">&gt;</span><span class="fl">0.6</span> <span class="sc">&amp;</span> math<span class="sc">&lt;</span> <span class="fl">0.9</span>)</span></code></pre></div>
</div>
<div id="条件筛选提取" class="section level4 hasAnchor" number="3.3.4.3">
<h4><span class="header-section-number">3.3.4.3</span> 条件筛选提取<a href="Data-preprocessing.html#条件筛选提取" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="使用subsetfiltermutate过滤" class="section level5 hasAnchor" number="3.3.4.3.1">
<h5><span class="header-section-number">3.3.4.3.1</span> 使用subset、filter、mutate过滤：<a href="Data-preprocessing.html#使用subsetfiltermutate过滤" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="Data-preprocessing.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">## base R :</span></span>
<span id="cb54-2"><a href="Data-preprocessing.html#cb54-2" aria-hidden="true" tabindex="-1"></a>tt <span class="ot">=</span> tt[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb54-3"><a href="Data-preprocessing.html#cb54-3" aria-hidden="true" tabindex="-1"></a>tt2 <span class="ot">=</span> <span class="fu">subset</span>(data_set, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(val1))</span>
<span id="cb54-4"><a href="Data-preprocessing.html#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="Data-preprocessing.html#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="Data-preprocessing.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="do">### filter() 根据值或条件筛选行：</span></span>
<span id="cb54-7"><a href="Data-preprocessing.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># filter() ::按数据需求，行或者列进行筛选；</span></span>
<span id="cb54-8"><a href="Data-preprocessing.html#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果想要过滤得到11月与12月出发的所有航班</span></span>
<span id="cb54-9"><a href="Data-preprocessing.html#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights,month <span class="sc">==</span> <span class="dv">11</span> <span class="sc">|</span> month <span class="sc">==</span> <span class="dv">12</span>)  <span class="do">## 注意这里的 “|”，表示并且的意思；</span></span>
<span id="cb54-10"><a href="Data-preprocessing.html#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="Data-preprocessing.html#cb54-11" aria-hidden="true" tabindex="-1"></a>df_dup <span class="sc">%&gt;%</span> </span>
<span id="cb54-12"><a href="Data-preprocessing.html#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">&quot;男&quot;</span>，math <span class="sc">&gt;</span><span class="dv">80</span>)</span>
<span id="cb54-13"><a href="Data-preprocessing.html#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 多条件筛选；</span></span>
<span id="cb54-14"><a href="Data-preprocessing.html#cb54-14" aria-hidden="true" tabindex="-1"></a>df_dup <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">&#39;女&#39;</span>，<span class="fu">is.na</span>(english) <span class="sc">|</span> math<span class="sc">&gt;</span><span class="dv">80</span>)<span class="er">)</span></span>
<span id="cb54-15"><a href="Data-preprocessing.html#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 闭区间筛选：</span></span>
<span id="cb54-16"><a href="Data-preprocessing.html#cb54-16" aria-hidden="true" tabindex="-1"></a>df_dup <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">between</span>(math,<span class="dv">70</span>,<span class="dv">80</span>))</span>
<span id="cb54-17"><a href="Data-preprocessing.html#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 指定列范围内根据条件筛选：</span></span>
<span id="cb54-18"><a href="Data-preprocessing.html#cb54-18" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">across</span>(<span class="fu">everything</span>()),<span class="sc">~</span> .x<span class="sc">&gt;</span><span class="dv">75</span>)</span>
<span id="cb54-19"><a href="Data-preprocessing.html#cb54-19" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">where</span>(is.numeric)),<span class="sc">~</span> .x<span class="sc">&gt;</span><span class="dv">75</span>) <span class="co"># 上述两公式等价；</span></span>
<span id="cb54-20"><a href="Data-preprocessing.html#cb54-20" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">across</span>(<span class="fu">everything</span>()),<span class="sc">~</span> <span class="sc">!</span><span class="fu">is.na</span>(.x))</span>
<span id="cb54-21"><a href="Data-preprocessing.html#cb54-21" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">where</span>(is。character)),is.na)</span>
<span id="cb54-22"><a href="Data-preprocessing.html#cb54-22" aria-hidden="true" tabindex="-1"></a>(<span class="co"># 根据包含指定值筛选行)</span></span>
<span id="cb54-23"><a href="Data-preprocessing.html#cb54-23" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">across</span>(<span class="fu">everything</span>()),<span class="sc">~</span><span class="fu">str_detect</span>(.x,<span class="st">&quot;bl&quot;</span>)))</span>
<span id="cb54-24"><a href="Data-preprocessing.html#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="Data-preprocessing.html#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 按行号过滤数据：</span></span>
<span id="cb54-26"><a href="Data-preprocessing.html#cb54-26" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">5</span>)</span>
<span id="cb54-27"><a href="Data-preprocessing.html#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="Data-preprocessing.html#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 除了使用filter进行过滤外，还可以使用mutate()函数进行过滤：</span></span>
<span id="cb54-29"><a href="Data-preprocessing.html#cb54-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 例如：</span></span>
<span id="cb54-30"><a href="Data-preprocessing.html#cb54-30" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">test =</span> <span class="fu">fcase</span>(iris<span class="sc">$</span>Sepal.Length<span class="sc">&gt;</span><span class="dv">5</span>,<span class="dv">1</span>, <span class="at">default =</span> <span class="dv">2</span>),</span>
<span id="cb54-31"><a href="Data-preprocessing.html#cb54-31" aria-hidden="true" tabindex="-1"></a>                iris<span class="sc">$</span>Species <span class="sc">==</span> <span class="st">&#39;virginica&#39;</span>  )</span></code></pre></div>
</div>
<div id="取交并补" class="section level5 hasAnchor" number="3.3.4.3.2">
<h5><span class="header-section-number">3.3.4.3.2</span> 取交并补<a href="Data-preprocessing.html#取交并补" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="Data-preprocessing.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 集合运算(或者说向量比较运算)</span></span>
<span id="cb55-2"><a href="Data-preprocessing.html#cb55-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">intersect</span>(x, y) <span class="do">## 返回x和y共同包含的观测</span></span>
<span id="cb55-3"><a href="Data-preprocessing.html#cb55-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">union</span>(x,y)   <span class="do">## 返回x和y中所有的唯一观测；</span></span>
<span id="cb55-4"><a href="Data-preprocessing.html#cb55-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">setdiff</span>(x,y)  <span class="do">## 返回在x中但不在y中的观测</span></span></code></pre></div>
</div>
<div id="嵌套构建与提取" class="section level5 hasAnchor" number="3.3.4.3.3">
<h5><span class="header-section-number">3.3.4.3.3</span> 嵌套构建与提取<a href="Data-preprocessing.html#嵌套构建与提取" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div id="嵌套构建" class="section level7" number="3.3.4.3.3.0.1">
<p class="heading"><span class="header-section-number">3.3.4.3.3.0.1</span> 嵌套构建</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="Data-preprocessing.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb56-2"><a href="Data-preprocessing.html#cb56-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="do">## 构建一种嵌套数据集：用metadata来嵌套数据内部：</span></span>
<span id="cb56-3"><a href="Data-preprocessing.html#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">character =</span> <span class="fu">c</span>(<span class="st">&quot;Toothless&quot;</span>, <span class="st">&quot;Dory&quot;</span>),</span>
<span id="cb56-4"><a href="Data-preprocessing.html#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata =</span> <span class="fu">list</span>(</span>
<span id="cb56-5"><a href="Data-preprocessing.html#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb56-6"><a href="Data-preprocessing.html#cb56-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">species =</span> <span class="st">&quot;dragon&quot;</span>,</span>
<span id="cb56-7"><a href="Data-preprocessing.html#cb56-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb56-8"><a href="Data-preprocessing.html#cb56-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">films =</span> <span class="fu">c</span>(</span>
<span id="cb56-9"><a href="Data-preprocessing.html#cb56-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;How to Train Your Dragon&quot;</span>,</span>
<span id="cb56-10"><a href="Data-preprocessing.html#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;How to Train Your Dragon 2&quot;</span>,</span>
<span id="cb56-11"><a href="Data-preprocessing.html#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;How to Train Your Dragon: The Hidden World&quot;</span></span>
<span id="cb56-12"><a href="Data-preprocessing.html#cb56-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb56-13"><a href="Data-preprocessing.html#cb56-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb56-14"><a href="Data-preprocessing.html#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb56-15"><a href="Data-preprocessing.html#cb56-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">species =</span> <span class="st">&quot;blue tang&quot;</span>,</span>
<span id="cb56-16"><a href="Data-preprocessing.html#cb56-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb56-17"><a href="Data-preprocessing.html#cb56-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">films =</span> <span class="fu">c</span>(<span class="st">&quot;Finding Nemo&quot;</span>, <span class="st">&quot;Finding Dory&quot;</span>)</span>
<span id="cb56-18"><a href="Data-preprocessing.html#cb56-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-19"><a href="Data-preprocessing.html#cb56-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-20"><a href="Data-preprocessing.html#cb56-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-21"><a href="Data-preprocessing.html#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用hoist来提取数据中参数，并指定或创建新的列名；</span></span>
<span id="cb56-22"><a href="Data-preprocessing.html#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 其中有趣的点是1L或3L这种形式，表示的是从list表中提取对应参数位置；</span></span>
<span id="cb56-23"><a href="Data-preprocessing.html#cb56-23" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">hoist</span>(metadata,</span>
<span id="cb56-24"><a href="Data-preprocessing.html#cb56-24" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;species&quot;</span>,</span>
<span id="cb56-25"><a href="Data-preprocessing.html#cb56-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">first_film =</span> <span class="fu">list</span>(<span class="st">&quot;films&quot;</span>, 1L),</span>
<span id="cb56-26"><a href="Data-preprocessing.html#cb56-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">third_film =</span> <span class="fu">list</span>(<span class="st">&quot;films&quot;</span>, 3L)</span>
<span id="cb56-27"><a href="Data-preprocessing.html#cb56-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb56-28"><a href="Data-preprocessing.html#cb56-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-29"><a href="Data-preprocessing.html#cb56-29" aria-hidden="true" tabindex="-1"></a>character species   first_film      third_film metadata    </span>
<span id="cb56-30"><a href="Data-preprocessing.html#cb56-30" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>           <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>list<span class="sc">&gt;</span>      </span>
<span id="cb56-31"><a href="Data-preprocessing.html#cb56-31" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> Toothless dragon    How to Train Y<span class="sc">~</span> How to Tr<span class="sc">~</span> <span class="er">&lt;</span>named list<span class="sc">&gt;</span></span>
<span id="cb56-32"><a href="Data-preprocessing.html#cb56-32" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Dory      blue tang Finding Nemo    <span class="cn">NA</span>         <span class="sc">&lt;</span>named list<span class="sc">&gt;</span></span></code></pre></div>
</div>
<div id="嵌套提取" class="section level6 hasAnchor" number="3.3.4.3.3.1">
<h6><span class="header-section-number">3.3.4.3.3.1</span> 嵌套提取<a href="Data-preprocessing.html#嵌套提取" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="Data-preprocessing.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 第一种方法：使用map_depth实现指定提取深度；</span></span>
<span id="cb57-2"><a href="Data-preprocessing.html#cb57-2" aria-hidden="true" tabindex="-1"></a>testlist2 <span class="sc">%&gt;%</span> <span class="fu">map_depth</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="st">&#39;veggie&#39;</span>)</span>
<span id="cb57-3"><a href="Data-preprocessing.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="Data-preprocessing.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 使用`[`和`[[`做深层提取：可以通过?`[`查询；</span></span>
<span id="cb57-5"><a href="Data-preprocessing.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> test <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">b=</span>letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb57-6"><a href="Data-preprocessing.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> test</span>
<span id="cb57-7"><a href="Data-preprocessing.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>a</span>
<span id="cb57-8"><a href="Data-preprocessing.html#cb57-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>]  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">8</span>  <span class="dv">9</span> <span class="dv">10</span></span>
<span id="cb57-9"><a href="Data-preprocessing.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>b</span>
<span id="cb57-10"><a href="Data-preprocessing.html#cb57-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;a&quot;</span> <span class="st">&quot;b&quot;</span> <span class="st">&quot;c&quot;</span> <span class="st">&quot;d&quot;</span> <span class="st">&quot;e&quot;</span> <span class="st">&quot;f&quot;</span> <span class="st">&quot;g&quot;</span> <span class="st">&quot;h&quot;</span> <span class="st">&quot;i&quot;</span> <span class="st">&quot;j&quot;</span></span>
<span id="cb57-11"><a href="Data-preprocessing.html#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="Data-preprocessing.html#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="st">&quot;[[&quot;</span>(test,<span class="dv">1</span>) <span class="co">#&gt; [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span id="cb57-13"><a href="Data-preprocessing.html#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="st">&quot;[[&quot;</span>(test,<span class="dv">2</span>) <span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot;</span></span>
<span id="cb57-14"><a href="Data-preprocessing.html#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="st">&quot;[&quot;</span>(test,<span class="dv">1</span>)  <span class="co">#&gt; $a [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span id="cb57-15"><a href="Data-preprocessing.html#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="st">&quot;[&quot;</span>(test,<span class="dv">2</span>)  <span class="co">#&gt; $b [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot;</span></span>
<span id="cb57-16"><a href="Data-preprocessing.html#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="Data-preprocessing.html#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="do">## `[`和`[[`与lapply结合来提取深层列表元素：</span></span>
<span id="cb57-18"><a href="Data-preprocessing.html#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(x, <span class="st">&#39;[[&#39;</span>, VarNames[[type]])</span></code></pre></div>
</div>
</div>
<div id="行筛选" class="section level5 hasAnchor" number="3.3.4.3.4">
<h5><span class="header-section-number">3.3.4.3.4</span> 行筛选<a href="Data-preprocessing.html#行筛选" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="Data-preprocessing.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 行筛选：</span></span>
<span id="cb58-2"><a href="Data-preprocessing.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>) </span>
<span id="cb58-3"><a href="Data-preprocessing.html#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="Data-preprocessing.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 上一行和下一行的值进行条件筛选：</span></span>
<span id="cb58-5"><a href="Data-preprocessing.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="do">## lag是访问当前行之前的行：lead是访问当前行的下一行：</span></span>
<span id="cb58-6"><a href="Data-preprocessing.html#cb58-6" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">trend =</span> <span class="fu">ifelse</span>(newdosage <span class="sc">&gt;</span> <span class="fu">lead</span>(newdosage),<span class="st">&#39;lower&#39;</span>,<span class="st">&#39;stable&#39;</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb58-7"><a href="Data-preprocessing.html#cb58-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">trend =</span> <span class="st">&quot;stable&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb58-8"><a href="Data-preprocessing.html#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="Data-preprocessing.html#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 批量行值筛选：</span></span>
<span id="cb58-10"><a href="Data-preprocessing.html#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 在这里是获取每个患者每个变量值的最大值；</span></span>
<span id="cb58-11"><a href="Data-preprocessing.html#cb58-11" aria-hidden="true" tabindex="-1"></a>data  <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( patient_id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.col=</span><span class="fu">c</span>(<span class="st">&quot;xjgs&quot;</span>,<span class="st">&quot;xjgs_one&quot;</span>,<span class="st">&quot;xjgs_more&quot;</span>,<span class="st">&quot;cz&quot;</span>,<span class="st">&quot;cz_one&quot;</span>,<span class="st">&quot;cz_more&quot;</span>,<span class="st">&quot;gzdm&quot;</span>,<span class="st">&quot;bwdxjt&quot;</span>,<span class="st">&quot;xlsj&quot;</span>,<span class="st">&quot;qxxxzb&quot;</span>), max,<span class="at">.names =</span> <span class="st">&quot;{.col}&quot;</span>)) </span>
<span id="cb58-12"><a href="Data-preprocessing.html#cb58-12" aria-hidden="true" tabindex="-1"></a>                         </span></code></pre></div>

</div>
</div>
</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="Data-extraction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Model-building.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-chinese/edit/master/03-Data-preprocessing.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
